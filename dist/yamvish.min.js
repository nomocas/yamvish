!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.y=t()}}(function(){return function t(e,n,i){function r(o,u){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){!function(){function t(e,n,i,r,s){"string"==typeof n&&(n=r.rules[n]);for(var o=n._queue,u=0,a=o.length;a>u;++u){var l=o[u];if(e=l.__lexer__?t(e,l,i,r,s):l.call(r,e,i,s),e===!1)return!1}return e}function n(){this._queue=[],this.__lexer__=!0}var i=/^[\s\n\r]+/;n.prototype={done:function(t){return this._queue.push(t),this},log:function(t){return t=t||"",this.done(function(e,n,i){return console.log("elenpi.log : ",t,e,n),e})},regExp:function(t,e,n){return this.done(function(i,r,s){if(!i)return e?i:!1;var o=t.exec(i);return o?(n&&("string"==typeof n?r[n]=o[0]:n.call(this,r,o,s)),i.substring(o[0].length)):e?i:!1})},"char":function(t,e){return this.done(function(n,i){return n?n[0]===t?n.substring(1):e?n:!1:!1})},xOrMore:function(e,n,i,r){return r=r||0,this.done(function(s,o,u){for(var a=[],l=!0,c=0;l&&s;){var h=e?this.createDescriptor?this.createDescriptor():{}:o;l=t(s,n,h,this,u),l!==!1&&(c++,s=l,h.skip||a.push(h),i&&s&&(l=t(s,i,h,this,u),l!==!1&&(s=l)))}return r>c?!1:(e&&a.length&&(o[e]=a),s)})},zeroOrMore:function(t,e,n){return this.xOrMore(t,e,n,0)},oneOrMore:function(t,e,n){return this.xOrMore(t,e,n,1)},zeroOrOne:function(e,n){return 1===arguments.length&&(n=e,e=null),this.done(function(i,r,s){if(!i)return i;var o=e?this.createDescriptor?this.createDescriptor():{}:r,u=t(i,n,o,this,s);return u!==!1&&(e&&(r[e]=o),i=u),i})},oneOf:function(e,n,i){return 1===arguments.length&&(n=e,e=null),this.done(function(r,s,o){if(!r)return!1;for(var u=0;u<n.length;){var a=e?this.createDescriptor?this.createDescriptor():{}:s,l=t(r,n[u],a,this,o);if(l!==!1)return e&&(s[e]=a),l;u++}return i?r:!1})},rule:function(e){return this.done(function(n,i,r){var s=this.rules[e];if(!s)throw new Error("elenpi.Rule :  rules not found : "+e);return t(n,s,i,this,r)})},skip:function(){return this.done(function(t,e){return e.skip=!0,t})},space:function(t){return this.done(function(e,n){if(!e)return t?!1:e;var r=(this.rules.space||i).exec(e);return r?e.substring(r[0].length):t?!1:e})},end:function(t){return this.done(function(e,n){return e&&t?!1:e})}};var r=function(t,e){this.rules=t,this.defaultRule=e};r.prototype={exec:function(e,n,i,r){return i||(i=this.rules[this.defaultRule]),t(e,i,n,this,r)},parse:function(t,e,n){var i=this.createDescriptor?this.createDescriptor():{},r=this.exec(t,i,e,n);return r===!1||r&&r.length>0?!1:i}};var s={r:function(){return new n},Rule:n,Parser:r};"undefined"!=typeof e&&e.exports?e.exports=s:this.elenpi=s}()},{}],2:[function(t,e,n){!function(){"use strict";var n=t("elenpi"),i=n.r,r={i:function(t){var e=parseInt(t,10);return isNaN(e)||e===1/0?null:e},f:function(t){var e=parseFloat(t);return isNaN(e)||e===1/0?null:e},b:function(t){return"true"===t?!0:"false"===t?!1:null},q:function(t){return"?"!==t[0]?null:t},s:function(t){return"?"==t[0]?null:t}},s={disjonction:i().regExp(/^\[\s*/).oneOrMore("disjonction",i().rule("xpr"),i().regExp(/^\s*,\s*/)).regExp(/^\s*\]/),cast:i().regExp(/^([\w-_]+):/,!0,function(t,e){if(t.cast=r[e[1]],!t.cast)throw new Error("routes : no cast method as : "+e[1])}),end:i().regExp(/^\$/,!1,"end"),steps:i().zeroOrMore("steps",i().rule("xpr"),i().regExp(/^\//)),block:i().regExp(/^\(\s*/).rule("steps").regExp(/^\s*\)/),key:i().regExp(/^[0-9\w-_\.]+/,!1,"key"),xpr:i().oneOf(null,[i().regExp(/^\!/,!1,"not"),i().regExp(/^\?/,!1,"optional")],!0).oneOf(null,[i().rule("cast").rule("key"),"end","disjonction","block"]),route:i().regExp(/^\./,!0,"local").regExp(/^\//).rule("steps")},o=new n.Parser(s,"route"),u=function(t){};u.prototype.match=function(t){var e=!1;if(t.route.length>=t.index)if(this.end)t.index===t.route.length&&(e=!0);else if(this.steps)e=this.steps.every(function(e){return e.match(t)});else if(this.disjonction)e=this.disjonction.some(function(e){return e.match(t)});else if(this.cast){var n=this.cast(t.route[t.index]);null!==n&&(t.output[this.key]=n,t.index++,e=!0)}else t.route[t.index]===this.key&&(t.index++,e=!0);if(this.not)e=!e;else if(!e&&this.optional)return!0;return e},o.createDescriptor=function(){return new u};var a=function(t){if(this.original=t,this.parsed=o.parse(t),!this.parsed)throw new Error("route could not be parsed : "+t)};a.prototype.match=function(t){if("string"==typeof t){var e=t.split("/");""===e[0]&&e.shift(),""===e[e.length-1]&&e.pop(),t={route:e,index:0,output:{}}}else t={route:t.route,index:this.parsed.local?t.index:0,output:{}};return this.parsed.match(t)?t:!1},e.exports=a}()},{elenpi:1}],3:[function(t,e,n){var i=function(t){return new i.Template(t)};i.env=t("./lib/env"),i.utils=t("./lib/utils"),i.Context=t("./lib/context"),i.Template=t("./lib/template"),i.PureNode=t("./lib/pure-node"),i.Container=t("./lib/container"),i.Filter=t("./lib/filter"),i.AsyncManager=t("./lib/async");var r=t("./lib/interpolable");i.interpolable=r.interpolable,i.Interpolable=r.Interpolable,i.addCustomTag=t("./lib/custom-tags"),i.listenerParser=t("./lib/parsers/listener-call"),i.elenpi=t("elenpi"),i.api=t("./lib/api"),t("./lib/output-engine/dom"),i.View=t("./lib/view"),i.view=function(t,e,n){return new i.View(t,e,n)},e.exports=i},{"./lib/api":5,"./lib/async":6,"./lib/container":7,"./lib/context":8,"./lib/custom-tags":9,"./lib/env":11,"./lib/filter":12,"./lib/interpolable":13,"./lib/output-engine/dom":14,"./lib/parsers/listener-call":18,"./lib/pure-node":22,"./lib/template":24,"./lib/utils":25,"./lib/view":26,elenpi:1}],4:[function(t,e,n){var i=t("./core");i.Virtual=t("./lib/virtual"),i.router=t("./lib/router"),i.html=t("./lib/parsers/html-string-to-template"),t("./lib/output-engine/string"),t("./lib/output-engine/twopass"),e.exports=i},{"./core":3,"./lib/output-engine/string":15,"./lib/output-engine/twopass":16,"./lib/parsers/html-string-to-template":17,"./lib/router":23,"./lib/virtual":27}],5:[function(t,e,n){e.exports={}},{}],6:[function(t,e,n){function i(){this._async={count:0,errors:[],successes:[],fails:[],callbacks:[]}}function r(t){t._async.count--,t._async.count<=0&&s(t)}function s(t){for(var e=t._async,n=e.errors.length?e.fails:e.successes,i=e.errors.length?e.errors:t,r=0;r<n.length;r++)n[r](i);t.emit&&t.emit("stabilised",t),e.successes=[],e.fails=[],e.errors=[]}function o(t,e){t&&t(),r(e)}var u=t("./emitter"),a=t("./utils");i.prototype={waiting:function(t){this._async.count++;var e=this;return this.parent&&this.parent.waiting&&this.parent.waiting(t),t.then(function(t){return r(e),t},function(t){throw e.env&&e.env.data.debug&&console.error("async waiting error : ",t),e._async.errors.push(t),r(e),t})},delay:function(t,e){return this._async.count++,this.parent&&this.parent.delay&&this.parent.delay(null,e),setTimeout(o,e,t,this)},stabilised:function(){if(0===this._async.count)return Promise.resolve(this);var t=this._async;return new Promise(function(e,n){t.successes.push(e),t.fails.push(n)})}},a.shallowMerge(u.prototype,i.prototype),e.exports=i},{"./emitter":10,"./utils":25}],7:[function(t,e,n){function i(t){s.call(this),this.__yContainer__=!0,this.childNodes=[],t&&(this.parent=t)}var r=t("./utils"),s=t("./pure-node"),o=t("./emitter");i.prototype={mount:function(t,e){if(this.destroyed)throw new Error("yamvish container has been destroyed. could not mount anymore.");if(t&&(t===this.mountPoint||t===this.mountSelector))return this;var n=t;if("string"==typeof n&&(this.mountSelector=t,n=r.domQuery(t)),!n)throw new Error("yamvish : mount point not found : "+t);if("insertBefore"===e){if(this.mountPoint=n.parentNode,!this.mountPoint)throw new Error("container mount fail : no parent found for insertBefore");this.mountSelector=null,r.mountChildren(this,this.mountPoint,n)}else this.mountPoint=n,!e&&n.childNodes&&n.childNodes.length&&r.emptyNode(n),r.mountChildren(this,n);return this.emit("mounted",this)},mountBefore:function(t){return this.mount(t,"insertBefore")},appendTo:function(t){return this.mount(t,"append")},unmount:function(){if(!this.mountPoint)return this;for(var t=0;t<this.childNodes.length;t++)this.mountPoint.removeChild(this.childNodes[t]);return this.mountPoint=null,this.mountSelector=null,this.emit("unmounted",this)},destroyer:function(){var t=this;return function(){t.destroy()}},destroy:function(){if(this.destroyed)throw new Error("yamvish container has been destroyed. could not mount anymore.");if(this.emit("destroy",this),this.binds){for(var t=0,e=this.binds.length;e>t;t++)this.binds[t]();this.binds=null}if(this.destroyed=!0,this.childNodes)for(var t=0;t<this.childNodes.length;t++)r.destroyElement(this.childNodes[t],!0);this.childNodes=null,this.context=null,this.mountPoint=null,this.mountSelector=null},hide:function(){return this.destroyed?this:void this.childNodes.forEach(function(t){t.style||(t.style={}),t.style.display="none"})},show:function(){return this.destroyed?this:void this.childNodes.forEach(function(t){t.style&&(t.style.display="")})}},r.shallowMerge(s.prototype,i.prototype),r.shallowMerge(o.prototype,i.prototype),i.prototype.appendChild=function(t,e){return s.prototype.appendChild.call(this,t),this.mountPoint&&(e=e||r.findNextSibling(this),t.__yPureNode__&&!t.__yVirtual__?r.mountChildren(t,this.mountPoint,e):e?this.mountPoint.insertBefore(t,e):this.mountPoint.appendChild(t)),t},i.prototype.removeChild=function(t){return this.childNodes?(s.prototype.removeChild.call(this,t),this.mountPoint&&r.removeChild(this.mountPoint,t),t):!1},i.prototype.insertBefore=function(t,e){return this.childNodes?(s.prototype.insertBefore.call(this,t,e),this.mountPoint&&r.insertBefore(this.mountPoint,t,e),t):!1},e.exports=i},{"./emitter":10,"./pure-node":22,"./utils":25}],8:[function(t,e,n){function i(t,e,n,r){if(a.call(this),this.__yContext__=!0,this.data=void 0!==t?t:{},this.map={},e){if(this.parent=e,this.env=r?new i(r):e.env,n){var s=this;this.path=n,this.binds=[],this.parent.subscribe(n,function(t){s.reset(t)},!1,this.binds)}}else this.env=r?new i(r):i.env}function r(t,e,n,i){return function(){t.destroyed||t.unsubscribe(e,n,i)}}function s(t,e,n,i,r){for(var s=0,o=t._upstreams.length;o>s;++s){var u=t._upstreams[s];if(u){var a=u.call(this,i,e,n,r);a&&a.then&&this.waiting(a)}else o=t._upstreams.length}}var o=t("./utils"),u=t("./env"),a=t("./async");i.prototype={destroy:function(){this.binds&&this.binds.forEach(function(t){t()}),this.destroyed=!0,this.binds=null,this.parent=null,this.data=null,this.map=null},get:function(t){switch(t.forEach||(t=t.split(".")),t[0]){case"$this":if(1===t.length)return this.data;break;case"$parent":if(!this.parent)throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));return this.parent.get(t.slice(1));case"$env":return this.env.get(t.slice(1))}var e=o.getProp(this.data,t);return void 0===e?"":e},dependent:function(t,e,n){var i,r=[],s=this,o=0;return this.binds=this.binds||[],e.forEach(function(e){r.push(s.get(e));var u=o++;s.subscribe(e,function(e,o,a,l){r[u]=e,i||(i=s.delay(function(){i&&(i=null,s.set(t,n.apply(s,r)))},0))},!1,this.binds)}),this.set(t,n.apply(this,r)),this},reset:function(t){return t===this.data||this.data instanceof Date&&t instanceof Date&&this.data.valueOf()===t.valueOf()?this:(this.data=t||{},this.notifyAll("reset",null,this.map,t,"*"),this)},toggle:function(t,e){return this.set(t,!this.get(t)),this},toggleInArray:function(t,e){for(var n=this.get(t),i=0,r=n.length;r>i;++i)if(n[i]===e)return this.del(t+"."+i),this;return this.push(t,e)},set:function(t,e){switch(t.forEach||(t=t.split(".")),t[0]){case"$this":if(1===t.length)return this.reset(e);break;case"$parent":if(this.parent)return this.parent.set(t.slice(1),e)&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));case"$env":return this.env.set(t.slice(1),e)&&this}var n=o.setProp(this.data,t,e);if(n!==e){if(n instanceof Date&&e instanceof Date&&n.valueOf()===e.valueOf())return this;this.notify("set",t,e,t[t.length-1])}return this},push:function(t,e){if(t.forEach||(t=t.split(".")),"$parent"==t[0]){if(this.parent)return this.parent.push(t.slice(1),e)&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."))}if("$env"===t[0])return this.env.push(t.slice(1),e)&&this;var n;if(n="$this"===t[0]?this.data:o.getProp(this.data,t),!n)throw new Error("yamvish.Context : Missing array at "+t.join(".")+" : couldn't push object.");if(!n.forEach)throw new Error("yamvish.Context : Object is not array at "+t.join(".")+" : couldn't push object.");return n.push(e),this.notify("push",t,e,n.length-1),this},del:function(t){if(t=t.forEach?t.slice():t.split("."),"$parent"==t[0]){if(this.parent)return this.parent.del(t.slice(1))&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."))}if("$env"==t[0])return this.env.del(t.slice(1))&&this;var e=t.slice(),n=e.pop(),i=e.length?o.getProp(this.data,e):this.data;if(i)if(i.forEach){var r=parseInt(n,10);r<i.length&&this.notify("removeAt",e,i.splice(r,1),r)}else{var s=i[n];delete i[n],this.notify("delete",t,s,n)}return this},subscribe:function(t,e,n,i){t.forEach||(t=t.split("."));var s;if("$this"===t[0])s=this.map;else{if("$env"===t[0])return this.env.subscribe(t.slice(1),e,n);if("$parent"===t[0]){if(!this.parent)throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));return this.parent.subscribe(t.slice(1),e,n)}s=o.getProp(this.map,t)}return n?s?(s._upstreams=s._upstreams||[]).push(e):o.setProp(this.map,t,{_upstreams:[e]}):s?(s._listeners=s._listeners||[]).push(e):o.setProp(this.map,t,{_listeners:[e]}),i&&i.push(r(this,t,e,n)),this},unsubscribe:function(t,e,n){if(this.distroyed)return this;t.forEach||(t=t.split("."));var i;if("$this"===t[0])i=this.map;else{if("$parent"===t[0])return this.env.unsubscribe(t.slice(1),e,n)&&this;if("$parent"===t[0]){if(this.parent)return this.parent.unsubscribe(t.slice(1),e,n)&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."))}i=o.getProp(this.map,t)}if(!i)return this;for(var r=n?i._upstreams:i._listeners,s=0,u=r.length;u>s;++s)if(r[s]===e){r.splice(s,1);break}return this},notifyAll:function(t,e,n,i,r){if(n=n||this.map,i=arguments.length<2?this.data:i,n._listeners)for(var s=0,o=n._listeners.length;o>s;++s){var u=n._listeners[s];if(u){var a=u.call(this,i,t,e,r);a&&a.then&&this.waiting(a)}else o=n._listeners.length}if("push"!==t&&"removeAt"!==t)for(var l in n)"_listeners"!==l&&"_upstreams"!==l&&this.notifyAll(t,e,n[l],i?i[l]:void 0,r);return this},notify:function(t,e,n,i){e.forEach||(e=e.split(".")),"$this"===e[0]&&(e=e.slice(1));for(var r,o=this.map,u=0,a=e.length;a>u&&(r=o["*"],r&&r._upstreams&&s.call(this,r,t,e,n,i),o=o[e[u]]);++u)o._upstreams&&s.call(this,o,t,e,n,i);return r&&this.notifyAll(t,e,r,n,i),o&&this.notifyAll(t,e,o,n,i),this},setAsync:function(t,e){var n=this;return this.waiting(e.then(function(e){return n.set(t,e),e},function(t){throw console.error("error while Context.setAsync : ",t),t}))},pushAsync:function(t,e){var n=this;return this.waiting(e.then(function(e){return n.push(t,e),e},function(t){throw console.error("error while Context.pushAsync : ",t),t}))},onAgora:function(t,e){var n=this.env.data.agora,i=this,r=function(){e.apply(i,arguments)};return n.on(t,r),(this.binds=this.binds||[]).push(function(){n.off(t,r)}),this},toAgora:function(t){var e=[t].concat([].slice.call(arguments,1));return this.env.data.agora.emit.apply(this.env.data.agora,e),this}},i.env=new i(u),delete i.env.env,o.shallowMerge(a.prototype,i.prototype),e.exports=i},{"./async":6,"./env":11,"./utils":25}],9:[function(t,e,n){var i=t("./template"),r=t("./api"),s=t("./context");i.prototype.__yield=function(){return this.exec({dom:function(t){var e=t.data.opts&&t.data.opts.__yield;if(e)return e.call(this,t)},string:function(t,e){var n=t.data.opts&&t.data.opts.__yield;n&&(e.children+=n.toHTMLString(t))}})};var o={dom:function(t,e){var n=new s({opts:e[0]},t),i=e[1].toContainer(n).appendTo(this);i.context=n},string:function(t,e,n){e.children+=n[1].toHTMLString(new s({opts:n[0]},t))},twopass:{first:function(t,e){(t.children=t.children||[]).push(new s({opts:e[0]},t))},second:function(t,e,n){e.children+=n[1].toHTMLString(t.children.shift())}}};e.exports=function(t,e,n,i){var s=r[t]=r[t]||{};return s[e]=function(t,e){for(var r in n)"undefined"==typeof t[r]&&(t[r]=n[r]);return t.__yield=e,this.exec(o,[t,i])},this}},{"./api":5,"./context":8,"./template":24}],10:[function(t,e,n){var i=function(){};i.prototype={on:function(t,e){return t="object"==typeof t?t.type:t,this._events=this._events||{},(this._events[t]=this._events[t]||[]).push(e),this},off:function(t,e){return t="object"==typeof t?t.type:t,this._events&&t in this._events!=!1?(this._events[t].splice(this._events[t].indexOf(e),1),this):this},once:function(t,e){var n=this;return this._events=this._events||{},(this._events[t]=this._events[t]||[]).push(function(i){n.off(t,e),e.call(this,i)}),this},emit:function(t){if(t="object"==typeof t?t.type:t,!this._events||t in this._events==!1)return this;for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,[].slice.call(arguments,1));return this}},e.exports=i},{}],11:[function(t,e,n){(function(n){var i="undefined"==typeof window&&"undefined"==typeof document,r=t("./emitter"),s={isServer:i,debug:!0,api:{},expressionsGlobal:i?n:window,factory:i?null:document,agora:new r,clone:function(t){var e={};for(var n in this)n===agora&&t?e.agora=new r:e[n]=this[n]}};e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./emitter":10}],12:[function(t,e,n){function i(t){this._queue=t?t._queue.slice():[]}var r=/^(?:[\w'"\(\),]+\s*){0,10}/;i.prototype={call:function(t,e){for(var n=0,i=this._queue.length;i>n;++n)e=this._queue[n].call(t,e);return e},lower:function(){return this._queue.push(function(t){return t.toLowerCase()}),this},upper:function(){return this._queue.push(function(t){return t.toUpperCase()}),this},json:function(t){return this._queue.push(function(e){return JSON.stringify.apply(JSON,t?[e,null," "]:[e])}),this},truncate:function(){return this._queue.push(function(t){var e=r.exec(t);return e?e[0]+"...":t}),this}},e.exports=i},{}],13:[function(t,e,n){function i(t,e){try{return t.call(e.data,e,e.env.data.expressionsGlobal)}catch(n){return console.error(n),""}}function r(t,e,n){var i=t+e;if(f[i])return n.push.apply(n,f[i].dependencies),f[i].func;var r=[];t=t.replace(l,function(t){if("true"==t||"false"==t||"null"==t)return t;switch(t[0]){case'"':case"'":return t;case"$":if("."===t[1])return"__global"+t.substring(1);default:if("("===t[t.length-1]){var e=t.substring(0,t.length-1);r.push(e);var n,i=e.split(".");return i.length>1&&(n=i.pop()),'__context.get(["'+i.join('","')+'"])'+(n?"."+n:"")+"("}return r.push(t),'__context.get(["'+t.split(".").join('","')+'"])'}}),n.push.apply(n,r);var s=new Function("__context","__global","return "+t+";");if(!e)return f[i]={func:s,dependencies:r},s;var o=new Function("Filter","return new Filter()."+e)(a),u=f[i]=function(t,e){return o.call(this,s.call(this,t,e))};return f[i]={func:u,dependencies:r},u}function s(t,e,n,r,s){return function(){var o=t.results[r];t.results[r]=i(n,e),o!==t.results[r]&&(1===t.dependenciesCount?s(t.output(e),"set"):t.willFire||(t.willFire=e.delay(function(){t.willFire&&(t.willFire=null,s(t.output(e),"set"))},0)))}}function o(t){var e=i(this.parts[1].func,t);return"undefined"!=typeof e||this._strict?e:""}function u(t){return function(){t.destroy()}}var a=t("./filter"),l=/true|false|null|\$\.(?:[a-zA-Z]\w*(?:\.\w*)*)|\$(?:[a-zA-Z]\w*(?:\.\w*)*)\(?|"[^"]*"|'[^']*'|[a-zA-Z_]\w*(?:\.\w*)*\(?/g,c=/\{\{\s*(.+?)((?:(?:\s\|\s)(.+?))?)\s*\}\}/,h={},f={},p=function(t){this.outputed=!1,this.results=[],this.willFire=null,this.parts=t.parts,this.dependenciesCount=t.dependenciesCount,this.directOutput=t.directOutput,this._strict=t._strict,this.binds=[]};p.prototype={output:function(t){if(this.directOutput)return this.outputed?this.results[0]:(this.outputed=!0,this.results[0]=this.directOutput(t));for(var e="",n=!0,r=0,s=0,o=this.parts.length;o>s;s++)n?e+=this.parts[s]:(e+=this.outputed?this.results[r]:this.results[r]=i(this.parts[s].func,t),r++),n=!n;return this.outputed=!0,e},destroy:function(){for(var t=0,e=this.binds.length;e>t;++t)this.binds[t]()}};var d=function(t,e){this.__interpolable__=!0,this._strict=e||!1;var n;5===t.length&&""===t[0]&&""===t[4]&&(this.directOutput=o),this.parts=[],this.dependenciesCount=0;for(var i=!1,s=0,u=t.length;u>s;s++)if(i=!i)this.parts.push(t[s]);else{var n=[];this.parts.push({func:r(t[s],t[s+2],n),dep:n}),s+=2,this.dependenciesCount+=n.length}};d.prototype={subscribeTo:function(t,e,n){for(var i=new p(this),r=0,o=1,a=this.parts.length;a>o;o+=2){var l=s(i,t,this.parts[o].func,r,e),c=this.parts[o].dep;r++;for(var h=0,f=c.length;f>h;h++)t.subscribe(c[h],l,!1,i.binds)}return n&&n.push(u(i)),i},output:function(t){if(this.directOutput)return this.directOutput(t);for(var e="",n=!0,r=this.parts,s=0,o=r.length;o>s;++s){if(n)e+=r[s];else{var u=i(r[s].func,t);if("undefined"==typeof u){if(this._strict)return;e+=""}e+=u}n=!n}return e}},e.exports={interpolable:function(t,e){if("string"!=typeof t)return t;if(h[t])return h[t];var n=t.split(c);return 1==n.length?t:h[t]=new d(n,e)},Interpolable:d}},{"./filter":12}],14:[function(t,e,n){function i(t,e,n,i){var r=new a(t,e),s=new o;return s.context=r,n.appendChild(s),i.call(s,r,n),s}function r(t,e,n){for(var i,r=e[0],s=0;r&&(i=r.engineBlock?r.engineBlock.dom:r.func||h[r.name],i(t.context||n,t,r.args),!r.suspendAfter);)r=e[++s]}var s=t("../utils"),o=t("../pure-node"),u=t("../container"),a=t("../context"),l=t("../template"),c=t("../view"),h={context:function(t,e,n){var i=n[0],r=n[1]||t,s=n[2];e.context=new a(i,r,s)},"with":function(t,e,n){var i=n[0],r=n[1],s=new a("string"==typeof i?t.get(i):i,t,i);r.call(e,s,container)},tag:function(t,e,n){var i=n[0],r=n[1],s=t.env.data.factory.createElement(i);r.call(s,t),e.appendChild(s)},text:function(t,e,n){var i,r=n[0];r.__interpolable__?(i=t.env.data.factory.createTextNode(r.output(t)),i.binds=i.binds||[],r.subscribeTo(t,function(t,e,n){i.nodeValue=t},i.binds)):i=t.env.data.factory.createTextNode(r),e.appendChild(i)},br:function(t,e){e.appendChild(t.env.data.factory.createElement("br"))},attr:function(t,e,n){var i=n[0],r=n[1],s=n[1];if(r.__interpolable__){s=r.output(t);var o=function(t,n,r){e.setAttribute(i,t)};e.binds=e.binds||[],r.subscribeTo(t,o,e.binds)}e.setAttribute(i,s)},disabled:function(t,e,n){var i=n[0],r=function(t,n,i){t?e.setAttribute("disabled"):e.removeAttribute("disabled")};i.__interpolable__?(e.binds=e.binds||[],i.subscribeTo(t,r,e.binds),r(i.output(t),"set")):r(void 0!==value?value:!0,"set")},val:function(t,e,n){var i=n[0],r=n[1];r.__interpolable__?(t.env.data.isServer||(e.addEventListener||e.on).call(e,"input",function(e){t.set(i,e.target.value)}),e.binds=e.binds||[],r.subscribeTo(t,function(t,n,i){e.setAttribute("value",t)},e.binds),e.setAttribute("value",r.output(t))):e.setAttribute("value",r)},setClass:function(t,e,n){var i=n[0],r=n[1],o=i,u=r,a=function(t,n,i){u=t,t?s.setClass(e,o):s.removeClass(e,o)};if(i.__interpolable__){var l=function(t,n,i){u&&(s.removeClass(e,o),s.setClass(e,t)),o=t};e.binds=e.binds||[],i.subscribeTo(t,l,e.binds),o=i.output(t)}r.__interpolable__?(e.binds=e.binds||[],r.subscribeTo(t,a,e.binds),a(r.output(t),"set")):a(r,"set")},css:function(t,e,n){var i=n[0],r=n[1],s=r;r.__interpolable__&&(s=r.output(t),e.binds=e.binds||[],r.subscribeTo(t,function(t,n,r){e.style[i]=t},e.binds)),e.style||(e.style={}),e.style[i]=s},visible:function(t,e,n){var i=n[0],r=i,s=(e.style?e.style.display:"")||"";e.style||(e.style={}),i.__interpolable__&&(r=i.output(t),e.binds=e.binds||[],i.subscribeTo(t,function(t,n,i){e.__yContainer__?t?e.show():e.hide():e.style.display=t?s:"none"},e.binds)),e.__yContainer__?r?e.show():e.hide():e.style.display=r?s:"none"},on:function(t,e,n){var i=n[0],r=n[1];(e.on||e.addEventListener).call(e,i,function(e){r.call(t,e)})},off:function(t,e,n){var i=n[0],r=n[1];(e.off||e.removeEventListener).call(e,i,r)},client:function(t,e,n){t.env.data.isServer||n[0].call(e,t)},server:function(t,e,n){t.env.data.isServer&&n[0].call(e,t)},"if":function(t,e,n){var i,r,o,u,a=n[0],l=n[1],c=n[2],h=s.hide(t.env.data.factory.createElement("div"));e.binds=e.binds||[];var f=function(n,u,a){var f=null;o&&(f=s.findNextSibling(o),o.unmount?o.unmount():e.removeChild(o)),n?(o=i,o||(o=i=l.toContainer(e.context||t),e.binds.push(o.destroyer()))):c?(o=r,o||(o=r=c.toContainer(e.context||t),e.binds.push(o.destroyer()))):o=h,o.__yContainer__?f?o.mountBefore(f):o.appendTo(e):e.insertBefore(o,f)};a&&a.__interpolable__?(u=a.output(t),e.binds=e.binds||[],a.subscribeTo(t,f,e.binds)):"function"==typeof a&&(u=a.call(e,t)),f(u,"set")},each:function(t,e,n){var r,u,a=n[0],l=n[1],c=n[2],h=new o,f=t.env.data.factory.createElement("div"),p=e.__yPureNode__&&!e.__yVirtual;h.childNodes=[],s.hide(f),e.appendChild(f),u=f,e.binds=e.binds||[];var d=function(n){if(u===h&&e.removeChild(h),c){if(u===r)return;u=r,u||(u=r=c.toContainer(e.context||t),e.binds.push(u.destroyer())),n?r.mountBefore(n):r.appendTo(e)}else u!==f&&(u=e.insertBefore(f,n))},v=function(t){u!==h&&(u===r?r.unmount():u===f&&e.removeChild(f),u=h,e.insertBefore(h,t))},g=function(n,r,o,a){switch(r){case"reset":case"set":(!e.__yPureNode__||e.mountPoint)&&s.hide(e.mountPoint||e);var c=s.findNextSibling(u);n.length?v(c):d(c);for(var f=0,g=n.length;g>f;++f)if(h.childNodes[f])h.childNodes[f].context.reset(n[f]);else{var _=i(n[f],e.context||t,h,l);(!p||e.mountPoint)&&s.mountChildren(_,e.mountPoint||e,c)}if(f<h.childNodes.length){for(h.childNodes.length;h.childNodes[f];)s.destroyElement(h.childNodes[f],!0)}(!e.__yPureNode__||e.mountPoint)&&s.show(e.mountPoint||e);break;case"removeAt":var c=s.findNextSibling(u);s.destroyElement(h.childNodes[a],!0),h.childNodes.length||d(c);break;case"push":var c=s.findNextSibling(u),_=i(n,e.context||t,h,l);v(c),(!p||e.mountPoint)&&s.mountChildren(_,e.mountPoint||e,c)}},_=a;"string"==typeof a&&(t.subscribe(a,g,!1,e.binds),t.subscribe(a+".*",function(t,e,n,i){var r=h.childNodes[i];return r?r.context.reset(t):void 0},!1,e.binds),_=t.get(a)),_&&g(_,"set")},"switch":function(t,e,n){var i,r=n[0],o=s.shallowCopy(n[1]);o["default"]||(o["default"]=s.hide(t.env.data.factory.createElement("div"))),e.binds=e.binds||[];var u=function(n,r,u){var a=o[String(n)],l=s.findNextSibling(i);a||(a=o["default"],n="default"),i&&(i.unmount?i.unmount():e.removeChild(i)),i=a,i.__yTemplate__&&(i=o[n]=a.toContainer(t).mountBefore(l),e.binds.push(i.destroyer())),i.__yContainer__?l?i.mountBefore(l):i.appendTo(e):e.insertBefore(i,l)};r.subscribeTo(t,u,e.binds),u(r.output(t),"set")},mountHere:function(t,e,n){(e.binds=e.binds||[]).push(n[0].toContainer(t).mount(e).destroyer())},suspendUntil:function(t,e,n){var i,r=n[0],s=n[1],o=n[2],u=r.__interpolable__?r.output(t):r,a=new l(o._queue.slice(s));u?a.call(e,t):r.__interpolable__&&(i=r.subscribeTo(t,function(n,i,r){n&&a.call(e,t)}))}};l.prototype.call=function(t,e){e=e||new a,r(t,this._queue,e)},l.prototype.toContainer=c.prototype.toContainer=function(t){var e=new u;return r(e,this._queue,t),e},c.prototype.call=function(t,e){this.toContainer(e).mount(t)},e.exports=h},{"../container":7,"../context":8,"../pure-node":22,"../template":24,"../utils":25,"../view":26}],15:[function(t,e,n){function i(){this.attributes="",this.classes="",this.children="",this.style=""}function r(t,e,n){var i="<"+n+e.attributes;e.style&&(i+=' style="'+e.style+'"'),e.classes&&(i+=' class="'+e.classes+'"'),e.children?t.children+=i+">"+e.children+"</"+n+">":o.test(n)?t.children+=i+">":u.test(n)?t.children+=i+"></"+n+">":t.children+=i+"/>"}var s=t("../utils"),o=t("../parsers/open-tags"),u=/span|script|meta/,a=t("../context"),l=t("../template"),c=t("../view");s.tagOutput=r;var h={SOD:i,context:function(t,e,n){var i=n[0],r=n[1]||t,s=n[2];e.context=new a(i,r,s)},each:function(t,e,n){var i=n[0],r="string"==typeof i?t.get(i):i;if(r&&r.length)for(var s=n[1],o=0,u=r.length;u>o;++o)s.toHTMLString(new a(r[o],t),e);else n[2]&&n[2].toHTMLString(t,e)},"with":function(t,e,n){var i=n[0],r=n[1],s=new a("string"==typeof i?t.get(i):i,t,i);r.toHTMLString(s,e,container)},"if":function(t,e,n){var r,s=n[0],o=n[1],u=n[2];s&&s.__interpolable__?r=s.output(t):"function"===type&&(r=s.call(this,t));var a=new i;r?o.toHTMLString(t,a):u&&u.toHTMLString(t,a),a.children&&(e.children+=a.children)},"switch":function(t,e,n){var r=n[0],s=n[1],o=r.output(t),u=s[o]||s["default"];if(u){var a=new i;u.toHTMLString(t,a),a.children&&(e.children+=a.children)}},tag:function(t,e,n){var s=n[0],o=n[1],u=new i;o.toHTMLString(t,u),r(e,u,s)},text:function(t,e,n){var i=n[0];e.children+=i.__interpolable__?i.output(t):i},br:function(t,e){e.children+="<br>"},attr:function(t,e,n){var i=n[0],r=n[1];e.attributes+=" "+i,r&&(e.attributes+='="'+(r.__interpolable__?r.output(t):r)+'"')},disabled:function(t,e,n){var i=n[0];(void 0===i||t.get(i))&&(e.attributes+=" disabled")},val:function(t,e,n){var i=(n[0],n[1]);e.attributes+=' value="'+(i.__interpolable__?i.output(t):i)+'"'},setClass:function(t,e,n){var i=n[0],r=n[1];(r.__interpolable__&&r.output(t)||r)&&(e.classes+=" "+(i.__interpolable__?i.output(t):i))},css:function(t,e,n){var i=n[0],r=n[1];e.style+=i+":"+(r.__interpolable__?r.output(t):r)},visible:function(t,e,n){var i=n[0],r=i.__interpolable__?i.output(t):i;r||(e.style+="display:none;")},on:function(){},off:function(){},client:function(t,e,n){t.env.data.isServer||n[0].toHTMLString(t,e)},server:function(t,e,n){t.env.data.isServer&&n[0].toHTMLString(t,e)},suspendUntil:function(t,e,n){var i=n[0],r=n[1],s=n[2],o=i.__interpolable__?i.output(t):i,u=new l(s._queue.slice(r));o&&u.toHTMLString(t,e)}};c.prototype.toHTMLString=function(t,e){var n=new i;return l.prototype.toHTMLString.call(this,t,n),e.children+=n.children,e.children},l.prototype.toHTMLString=function(t,e){t=t||new a,e=e||new i;for(var n,r=this._queue[0],s=0;r;)n=r.engineBlock?r.engineBlock.string:r.func||h[r.name],n(e.context||t,e,r.args),r=this._queue[++s];return e.children},e.exports=h},{"../context":8,"../parsers/open-tags":19,"../template":24,"../utils":25,"../view":26}],16:[function(t,e,n){function i(t,e,n){n=n||new l;for(var i,r,s=0,o=t._queue.length;o>s;++s){if(i=t._queue[s],i.engineBlock)r=i.engineBlock.twopass.second||i.engineBlock.string;else if(i.func){if(i.firstPass)continue;r=i.func}else r=f[i.name]?f[i.name]:a[i.name];r(n.context||e,n,i.args)}}function r(t,e){for(var n,i,r,s,o=0,u=t._queue.length;u>o;++o){if(n=t._queue[o],n.engineBlock){if(i=n.engineBlock.twopass.first,!i)continue}else if(n.func){if(!n.firstPass)continue;i=n.func}else{if(!h[n.name])continue;i=h[n.name]}s=i(r||e,n.args),s&&s.__yContext__&&(r=s)}}var s=t("../utils"),o=t("../template"),u=t("../context"),a=t("./string"),l=a.SOD,c=t("../view"),h={context:function(t,e){var n=e[0],i=e[1]||t,r=e[2],s=new u(n,i,r);return(t.children=t.children||[]).push(s),s},"with":function(t,e,n){var i=n[0],r=new u("string"==typeof i?t.get(i):i,t,i);(t.children=t.children||[]).push(r)},"if":function(t,e){var n,i=e[0],s=e[1],o=e[2],u=function(e,n,i){e?r(s,t):o&&r(o,t)};i&&i.__interpolable__?(n=i.output(t),i.subscribeTo(t,u)):"function"==typeof i&&(n=i.call(this,t)),u(n,"set")},each:function(t,e){var n=e[0],i=e[1],s=e[2],o=!1,a=n,l=[],c=function(e,n,a,c){
var h,f=l;switch(n){case"reset":case"set":e.length||o||r(s,t);for(var p=0,d=e.length;d>p;++p)f[p]?f[p].reset(e[p]):(h=new u(e[p],t),f.push(h),r(i,h));if(p<f.length){for(var v=p,d=f.length;d>v;++v)f[v].destroy();f.splice(p)}break;case"removeAt":f.splice(c,1);break;case"push":h=new u(e,t),f.push(h),r(i,h)}};"string"==typeof n&&(t.subscribe(n,c),t.subscribe(n+".*",function(t,e,n,i){var r=l[i];return r?r.reset(t):void 0}),a=t.get(n)),a&&c(a,"set"),(t.children=t.children||[]).push(l)},tag:function(t,e){var n=(e[0],e[1]);n&&r(n,t)},client:function(t,e){t.env.data.isServer||r(e[0],t)},server:function(t,e){t.env.data.isServer&&r(e[0],t)}},f={context:function(t,e){t.children&&(e.context=t.children.shift())},"with":function(t,e,n){if(t.children){var r=(n[0],n[1]),s=t.children.shift();i(r,s,e)}},each:function(t,e,n){if(t.children){var r=t.children.shift();if(r&&r.length){var s=n[1],o=n[2];if(r.length)for(var u=0,a=r.length;a>u;++u)i(s,r[u],e);else i(o,t,e)}}},tag:function(t,e,n){var r=n[0],o=n[1],u=new l;o&&i(o,t,u),s.tagOutput(e,u,r)},"if":function(t,e,n){var r,s=n[0],o=n[1],u=n[2];s&&s.__interpolable__?r=s.output(t):"function"===type&&(r=s.call(this,t)),r?i(o,t,e):u&&i(u,t,e)},client:function(t,e,n){t.env.data.isServer||i(n[0],t,e)},server:function(t,e,n){t.env.data.isServer&&i(n[0],t,e)},contentSwitch:null,cssSwitch:null};o.prototype.twopass=c.prototype.twopass=function(t){t=t||new u,r(this,t);var e=this;return t.stabilised().then(function(t){var n=new l;return i(e,t,n),n.children})},e.exports={firstMethods:h,secondMethods:f,firstPass:r,secondPass:i}},{"../context":8,"../template":24,"../utils":25,"../view":26,"./string":15}],17:[function(t,e,n){var i=t("elenpi"),r=i.r,s=i.Parser,o=t("../template"),u=t("./string-to-template"),a={openTags:t("./open-tags"),document:r().zeroOrMore(null,r().space().rule("comment")).regExp(/^\s*<!DOCTYPE[^>]*>\s*/i,!0).rule("children").space(),comment:r().regExp(/^<!--(?:.|\n|\r)*?(?=-->)-->/),tagEnd:r().regExp(/^\s*<\/([\w-_]+)\s*>/,!1,function(t,e){if(t.tagName!==e[1].toLowerCase())throw new Error("tag badly closed : "+e[1]+" - (at opening : "+t.tagName+")")}),innerScript:r().done(function(t,e){var n=t.indexOf("</script>");if(-1===n)throw new Error("script tag badly closed.");return n&&(e.scriptContent=t.substring(0,n)),t.substring(n+9)}),children:r().zeroOrMore(null,r().oneOf([r().space().rule("comment").skip(),r().space().rule("tag"),r().rule("text")])),text:r().regExp(/^[^<]+/,!1,function(t,e){t.text(e[0])}),tag:r().regExp(/^<([\w-_]+)\s*/,!1,function(t,e){t.tagName=e[1].toLowerCase()}).done(function(t,e){return e._attributesTemplate=new o,this.exec(t,e._attributesTemplate,this.rules.attributes)}).oneOf([r()["char"](">").done(function(t,e){if(this.rules.openTags.test(e.tagName))return t;if("script"===e.tagName)return this.exec(t,e,this.rules.innerScript);e._innerTemplate=new o;var n=this.exec(t,e._innerTemplate,this.rules.children);return n===!1?!1:this.exec(n,e,this.rules.tagEnd)}),r().regExp(/^\/>/)]).done(function(t,e){var n=e._innerTemplate,i=e._attributesTemplate;return n&&(i._queue=i._queue.concat(n._queue)),e.tag(e.tagName,i),e._attributesTemplate=null,e._innerTemplate=null,e.tagName=null,t}),attributes:r().zeroOrMore(null,r().regExp(/^([\w-_]+)\s*(?:=(?:"([^"]*)"|([\w-_]+)))?\s*/,!1,function(t,e){var n=e[1],i=void 0!==e[2]?e[2]:void 0!==e[3]?e[3]:"";switch(n){case"class":if(!i)break;i.split(/\s+/).forEach(function(e){t.setClass(e)});break;case"data-template":if(!i)break;var r=u.parseTemplate(i);if(r===!1)throw new Error("data-template attribute parsing failed : "+i);t._queue=t._queue.concat(r._queue);break;default:t.attr(n,i)}}))},l=new s(a,"children");l.createDescriptor=function(){return new o},e.exports=l},{"../template":24,"./open-tags":19,"./string-to-template":21,elenpi:1}],18:[function(t,e,n){var i=t("elenpi"),r=i.r,s=i.Parser,o=t("./primitive-argument-rules"),u={path:r().oneOrMore(null,r().regExp(/^[\w-_\$]+/,!1,function(t,e){(t.path=t.path||[]).push(e[0])}),r().regExp(/^\./)),call:r().rule("path").done(function(t,e){return e.method=e.path,e.path=null,e.arguments=[],t}).zeroOrOne(null,r().regExp(/^\s*\(\s*/).zeroOrMore(null,r().oneOf(["integer","float","bool","singlestring","doublestring",r().rule("path").done(function(t,e){return e.arguments.push(e.path),e.path=null,t})]),r().regExp(/^\s*,\s*/)).regExp(/^\s*\)/))};for(var a in o)u[a]=o[a];var l=new s(u,"call");l.parseListener=function(t){var e=this.parse(t);if(!e.method)throw new Error("yamvish listener badly formatted : "+t);return function(n){var i=this.get(e.method);if(!i)throw new Error("yamvish listener not found : "+t);if(!e.arguments)return i.call(this,n);for(var r=[n],s=0,o=e.arguments.length;o>s;++s){var u=e.arguments[s];r.push(u.forEach?this.get(u):u)}return i.apply(this,r)}},e.exports=l},{"./primitive-argument-rules":20,elenpi:1}],19:[function(t,e,n){e.exports=/(br|input|img|area|base|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)/},{}],20:[function(t,e,n){var i=t("elenpi").r,r={doublestring:i().regExp(/^"([^"]*)"/,!1,function(t,e){t.arguments.push(e[1])}),singlestring:i().regExp(/^'([^']*)'/,!1,function(t,e){t.arguments.push(e[1])}),"float":i().regExp(/^[0-9]*\.[0-9]+/,!1,function(t,e){t.arguments.push(parseFloat(e[0],10))}),integer:i().regExp(/^[0-9]+/,!1,function(t,e){t.arguments.push(parseInt(e[0],10))}),bool:i().regExp(/^(true|false)/,!1,function(t,e){t.arguments.push("true"===e[1]?!0:!1)})};e.exports=r},{elenpi:1}],21:[function(t,e,n){function i(t){for(var e=new u,n=0,i=t.length;i>n;++n){var r=t[n];if(!e[r.method])throw new Error("no handler found in Template as : "+r.method);e[r.method].apply(e,r.arguments)}return e}var r=t("elenpi"),s=r.r,o=r.Parser,u=t("../template"),a=t("./primitive-argument-rules"),l={templates:s().space().zeroOrMore("calls",s().rule("template"),s().regExp(/^\s*\.\s*/)).done(function(t,e){var n;return e.calls&&(n=i(e.calls)),n&&e.arguments?(e.arguments.push(n),delete e.calls):e.calls=n,t}),template:s().regExp(/^[\w-_]+/,!1,function(t,e){t.method=e[0],t.arguments=[]}).zeroOrOne(null,s().regExp(/^\s*\(\s*/).zeroOrMore(null,s().oneOf(["integer","float","bool","singlestring","doublestring","templates"]),s().regExp(/^\s*,\s*/)).regExp(/^\s*\)/))};for(var c in a)l[c]=a[c];var h=new o(l,"templates"),f={};h.parseTemplate=function(t){if(void 0!==f[t])return f[t].calls;var e=f[t]=h.parse(t);return e===!1?!1:e.calls},e.exports=h},{"../template":24,"./primitive-argument-rules":20,elenpi:1}],22:[function(t,e,n){function i(){this.__yPureNode__=!0}i.prototype={insertBefore:function(t,e){if(!e)return(this.childNodes=this.childNodes||[]).push(t),t;if(!this.childNodes)throw new Error("node was not found : "+e.toString());var n=this.childNodes.indexOf(e);if(-1==n)throw new Error("node was not found : "+e.toString());return 0==n?this.childNodes.unshift(t):this.childNodes.splice(n,0,t),t},appendChild:function(t){return this.childNodes=this.childNodes||[],this.childNodes.push(t),t.parentNode=this,t},removeChild:function(t){if(!this.childNodes)return!1;for(var e=0,n=this.childNodes.length;n>e;++e)if(this.childNodes[e]===t)return t.parentNode=null,this.childNodes.splice(e,1),t;return!1},toString:function(){if(!this.childNodes)return"";for(var t="",e=0,n=this.childNodes.length;n>e;++e)t+=this.childNodes[e].toString();return t}},e.exports=i},{}],23:[function(t,e,n){function i(t){var e=t.parent;return e?e&&e.isRouted?e:i(e):null}function r(t){var e=t.split("/");return""===e[0]&&e.shift(),""===e[e.length-1]&&e.pop(),{length:e.length,route:e,index:0}}var s=t("./utils"),o=t("./view"),u=t("./template"),a=t("routedsl");u.prototype.clickTo=function(t,e,n){return this.client(y().click(function(i){i.preventDefault()&&i.preventDefault(),t!==location.pathname+location.search&&(this.env.data.agora.emit("route:update",t,e||"",n),window.history.pushState({href:t,title:e,data:n},e||"",t),document.title=e||"")}))};var l={parser:function(t){return new a(t)},bindHistory:function(t){if(!t.env.data.isServer){var e=r(location.pathname+(location.search||""));t.isRouted=!0,t.set("$route",e),t.onAgora("route:update",function(t,e,n){this.set("$route",t)}),window.addEventListener("popstate",function(e){var n=r(location.pathname+(location.search||""));t.env.data.agora.emit("route:update",n),document.title=e.state?e.state.title||"":""})}}};o.prototype.route=function(t,e){var n=this._queue.length+1,r=this,t=l.parser(t);return this.exec({dom:function(o,a,l){var c,h,f,p,d=!1,v=s.hide(o.env.data.factory.createElement("div")),g=new u(r._queue.slice(n));a.appendChild(v),p=v,o.isRouted=!0;var _=function(n,i){if(a.mountPoint&&n!==f){f=n;var r=t.match(n.lastMatched||n);if(r){if(n.lastMatched=r,e&&e.call(o,r),o.set("$route",r),d||(g.call(a,o),g=null,d=!0),p===a)return;p=a;var u=s.findNextSibling(v);a.removeChild(v),a.childNodes.forEach(function(t){s.insertBefore(a.mountPoint,t,u)})}else{if(p===v)return;p=v,a.appendChild(v),a.childNodes.forEach(function(t){t!==v&&(t.__yPureNode__?s.unmountPureNode(t):t.parentNode&&t.parentNode.removeChild(t))})}}};c=i(o),c&&(a.binds=a.binds||[],c.subscribe("$route",_,!1,a.binds),h=c.data.$route),a.on("mounted",function(){var t=c?c.data.$route:null;t&&_(t,"set")}),h&&_(h,"set")},string:function(t,e,n){},twopass:{firstPass:function(t,e){},secondPass:function(t,e,n){}}},null,!1,!0)},e.exports=l},{"./template":24,"./utils":25,"./view":26,routedsl:2}],24:[function(t,e,n){"use strict";function i(t){this.__yTemplate__=!0,t?t.forEach?this._queue=t:this._queue=t._queue.slice():this._queue=[]}function r(){return new i}function s(t,e){return Array.prototype.slice.call(t,e)}function o(t,e){var n=r();for(var i in t)n[e](i,t[i]);return n}function u(t){var e=r();for(var n in t)switch(n){case"style":e.use(o(t[n],"css"));break;case"classes":e.use(o(t[n],"cl"));break;case"value":e.val(t[n]);break;case"disabled":e.disabled(t[n]);break;case"visible":e.visible(t[n]);break;default:e.attr(n,t[n])}return e}var a=t("./utils"),l=t("./interpolable").interpolable,c=(t("./context"),t("./api")),h=t("./parsers/listener-call");a.parseAttrMap=u,i.prototype={exec:function(t,e,n,i){var r=typeof t;return this._queue.push({func:"function"===r?t:null,engineBlock:"object"===r?t:null,name:"string"===r?t:null,args:e,firstPass:n,suspendAfter:i}),this},set:function(t,e){return this.exec(function(n){n.set(t,e)},null,!0)},setAsync:function(t,e){return this.exec(function(n){n.setAsync(t,e)},null,!0)},dependent:function(t,e,n){return this.exec(function(i){i.dependent(t,e,n)},null,!0)},push:function(t,e){return this.exec(function(n){n.push(t,e)},null,!0)},pushAsync:function(t,e){return this.exec(function(n){n.pushAsync(t,e)},null,!0)},toggle:function(t){return this.exec(function(e){e.toggle(t)},null,!0)},toggleInArray:function(t){return this.exec(function(e){e.toggleInArray(t)},null,!0)},del:function(t){return this.exec(function(e){e.del(t)},null,!0)},context:function(t,e,n){var n;return"string"==typeof t&&(n=t,t=null),this.exec("context",[n?void 0:t,e,n],!0)},"with":function(t,e){return this.exec("with",[t,e],!0)},subscribe:function(t,e,n){return this.exec(function(i){i.subscribe(t,e,n)},null,!0)},unsubscribe:function(t,e,n){return this.exec(function(i){i.unsubscribe(t,e,n)},null,!0)},onAgora:function(t,e){return this.exec(function(n){n.onAgora(t,e)},null,!0)},offAgora:function(t,e){return this.exec(function(n){n.offAgora(t,e)},null,!0)},toAgora:function(t,e){return this.exec(function(n){n.toAgora(t,e)},null,!0)},attr:function(t,e){return this.exec("attr",[t,l(e)])},disabled:function(t){return this.exec("disabled",[l(t)])},val:function(t){var e;if("string"==typeof t&&(t=l(t),t.__interpolable__)){if(1!==t.dependenciesCount)throw new Error("template.val expression could only depend to one variable.");e=t.parts[1].dep[0]}return this.exec("val",[e,t])},setClass:function(t,e){return e="undefined"==typeof e?!0:l(e),this.exec("setClass",[l(t),e])},css:function(t,e){return this.exec("css",[t,l(e)])},visible:function(t){return this.exec("visible",[l(t)])},text:function(t){return this.exec("text",[l(t)])},tag:function(t,e){var n,i=e&&"object"==typeof e&&!e.__yTemplate__?e:null;n=i?u(e):r();for(var s=i?2:1,o=arguments.length;o>s;++s)arguments[s]&&(arguments[s].__yTemplate__?n.use(arguments[s]):n.text(arguments[s]));return this.exec("tag",[t,n])},br:function(){return this.exec("br")},a:function(t){var e=s(arguments,1);return e.unshift("a","string"==typeof t?r().attr("href",t):t),this.tag.apply(this,e)},img:function(t){var e=s(arguments,1);return e.unshift("img","string"==typeof t?r().attr("src",t):t),this.tag.apply(this,e)},input:function(t,e){var n;if("string"==typeof t){n=s(arguments,2);var i=r().attr("type",t);e&&i.val(e),n.unshift("input",i)}else n=s(arguments);return this.tag.apply(this,n)},h:function(t){var e=s(arguments,1);return e.unshift("h"+t),this.tag.apply(this,e)},space:function(){return this.exec("text",[" "])},nbsp:function(){return this.exec("text",["Â "])},on:function(t,e){return"string"==typeof e&&(e=h.parseListener(e)),this.exec("on",[t,e])},off:function(t,e){return this.exec("off",[t,e])},each:function(t,e,n){return this.exec("each",[t,e,n])},"if":function(t,e,n){return this.exec("if",[l(t),e,n])},"switch":function(t,e){for(var n in e)"string"==typeof e[n]&&(e[n]=r().text(e[n]));return this.exec("contentSwitch",[l(t),e])},use:function(t){var e=s(arguments);e.shift(),"string"==typeof t&&(t=t.split(":"));var n=t.forEach?a.getApiMethod(c,t):t;return n.__yView__?this.exec("mountHere",[n]):(n.__yTemplate__?this._queue=this._queue.concat(n._queue):n.apply(this,e),this)},addApi:function(t){var e="string"==typeof t?c[t]:t;if(!e)throw new Error("no template api found with : "+t);for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);return this},mountHere:function(t){return this.exec("mountHere",[t])},client:function(t){return this.exec("client",[t])},server:function(t){return this.exec("server",[t])},suspendUntil:function(t){return this.exec("suspendUntil",[l(t),this._queue.length+1,this],!1,!0)}},i.addAPI=function(t){for(var e in t)i.prototype[e]=t[e];return i},i.prototype.cl=i.prototype.setClass,["div","span","ul","li","button","p","form","table","tr","td","th","section","code","pre","q","blockquote","style","nav","article","header","footer","aside"].forEach(function(t){i.prototype[t]=function(){var e=s(arguments);return e.unshift(t),this.tag.apply(this,e)}}),["click","blur","focus","submit"].forEach(function(t){i.prototype[t]=function(e){return this.on(t,e)}}),e.exports=i},{"./api":5,"./context":8,"./interpolable":13,"./parsers/listener-call":18,"./utils":25}],25:[function(t,e,n){function i(t,e){var n=new Error(t);return n.report=e,n}function r(t,e){var n=0;"$this"===e[0]&&(n=1);for(var i=t,r=n,s=e.length;s>r;++r)if(!i||void 0===(i=i[e[r]]))return;return i}function s(t,e){var n=t,i=0;for(len=e.length-1;i<len;++i)if(n&&!(n=n[e[i]]))return;n&&delete n[e[i]]}function o(t,e,n){for(var i,r=t,s=0,o=e.length-1;o>s;++s)r=r&&!r[e[s]]?r[e[s]]={}:r[e[s]];return r&&(i=r[e[s]],r[e[s]]=n),i}function u(t){if(t.childNodes&&t.childNodes.length){for(var e=0,n=t.childNodes.length;n>e;++e)a(t.childNodes[e]);t.__yVirtual__?t.childNodes=[]:t.innerHTML=""}}function a(t,e){if(t.context&&t.context.destroy(),e&&t.parentNode&&(t.parentNode.removeChild(t),t.parentNode=null),t.__yPureNode__?(t.__yVirtual__&&(t.attributes=null,t.listeners=null,t.classes=null,t.style=null),t.childNodes&&t.childNodes.length&&l(t,e)):t.childNodes&&t.childNodes.length&&l(t),t.binds){for(var n=0,i=t.binds.length;i>n;n++)t.binds[n]();t.binds=null}}function l(t,e){if(t.childNodes)for(var n=0;n<t.childNodes.length;n++)a(t.childNodes[n],e)}function c(t,e,n){if(t.childNodes&&t.__yPureNode__)if(n)for(var i=0,r=t.childNodes.length;r>i;++i){var s=t.childNodes[i];s.__yPureNode__&&!s.__yVirtual__?c(s,e,n):e.insertBefore(s,n)}else for(var o=0,r=t.childNodes.length;r>o;++o){var s=t.childNodes[o];s.__yPureNode__&&!s.__yVirtual__?c(s,e):e.appendChild(s)}}function h(t){for(var e=t;e&&!e.__yVirtual__&&e.__yPureNode__&&e.childNodes&&e.childNodes.length;)e=e.childNodes[e.childNodes.length-1];return!e||e.__yPureNode__&&!e.__yVirtual__?null:e.nextSibling||null}function f(t){for(var e=0,n=t.childNodes.length;n>e;++e){var i=t.childNodes[e];i.__yPureNode__?f(i):i.parentNode!==t&&i.parentNode.removeChild(i)}}function p(t,e){t.__yVirtual__?(t.el&&t.el.classList.add(e),(t.classes=t.classes||{})[e]=!0):t.classList.add(e)}function d(t,e){t.__yVirtual__?(t.el&&t.el.classList.remove(e),t.classes&&delete t.classes[e]):t.classList.remove(e)}var v=e.exports={produceError:i,destroyElement:a,destroyChildren:l,setProp:o,deleteProp:s,getProp:r,emptyNode:u,unmountPureNode:f,mountChildren:c,setClass:p,removeClass:d,findNextSibling:h,removeChild:function(t,e){if(e.__yPureNode__&&!e.__yVirtual__){if(e.childNodes)for(var n=0,i=e.childNodes.length;i>n;++n)v.removeChild(t,e.childNodes[n])}else e.parentNode&&e.parentNode.removeChild(e)},insertBefore:function(t,e,n){if(e.__yPureNode__&&!e.__yVirtual__){if(e.childNodes)for(var i=0,r=e.childNodes.length;r>i;++i)v.insertBefore(t,e.childNodes[i],n)}else t.insertBefore(e,n)},hide:function(t){return t.__yContainer__?t.hide():(t.style||(t.style={}),t.style.display="none",t)},show:function(t){return t.__yContainer__?t.show():(t.style||(t.style={}),t.style.display="",t)},domQuery:function(t){return"#"===t[0]?document.getElementById(t.substring(1)):document.querySelector(t)},shallowMerge:function(t,e){for(var n in t)e[n]=t[n]},shallowCopy:function(t){if(t&&t.forEach)return t.slice();if(t&&"object"==typeof t){if(t instanceof RegExp||t instanceof Date)return t;var e={};for(var n in t)e[n]=t[n];return e}return t},getApiMethod:function(t,e){if(e.forEach||(e=e.split(":")),2!==e.length)throw new Error("yamvish method call badly formatted : "+e.join(":"));var n=t[e[0]][e[1]];if(!n)throw new Error('no template/container found with "'+e.join(":")+'"');return n}}},{}],26:[function(t,e,n){function i(t,e,n){this.__yView__=!0,r.call(this),this.context(t,e,n).exec(function(t){t.viewData={}},null,!0).exec(function(t,e){t.viewData.container=e})}var r=t("./template");i.prototype=new r,["attr","css","setClass","cl","visible","disabled","val"].forEach(function(t){i.prototype[t]=null}),e.exports=i},{"./template":24}],27:[function(t,e,n){function i(t,e){o.call(this),this.__yVirtual__=!0,this.tagName=t,e&&(this.nodeValue=e)}var r=t("./utils"),s=t("./emitter"),o=t("./pure-node"),u=t("./parsers/open-tags");i.prototype={setAttribute:function(t,e){(this.attributes=this.attributes||{})[t]=e},removeAttribute:function(t,e){this.attributes&&delete this.attributes[t]},addEventListener:s.prototype.on,removeEventListener:s.prototype.off,dispatchEvent:s.prototype.emit},r.shallowMerge(o.prototype,i.prototype),i.prototype.toString=function(){if("textnode"===this.tagName)return this.nodeValue;var t="<"+this.tagName;this.id&&(t+=' id="'+this.id+'"');for(var e in this.attributes)t+=" "+e+'="'+this.attributes[e]+'"';if(this.classes){var n=Object.keys(this.classes);n.length&&(t+=' class="'+n.join(" ")+'"')}if(this.childNodes&&this.childNodes.length){t+=">";for(var i=0,r=this.childNodes.length;r>i;++i)t+=this.childNodes[i].toString();t+="</"+this.tagName+">"}else t+=this.scriptContent?">"+this.scriptContent+"</script>":u.test(this.tagName)?">":" />";return t},i.createElement=function(t){return new i(t)},i.createTextNode=function(t){return new i("textnode",t)},e.exports=i},{"./emitter":10,"./parsers/open-tags":19,"./pure-node":22,"./utils":25}]},{},[4])(4)});