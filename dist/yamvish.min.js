!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.y=t()}}(function(){return function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e){!function(){function t(e,n,r,i,s){"string"==typeof n&&(n=i.rules[n]);for(var o=n._queue,a=0,u=o.length;u>a;++a){var c=o[a];if(e=c.__lexer__?t(e,c,r,i,s):c.call(i,e,r,s),e===!1)return!1}return e}function n(){this._queue=[],this.__lexer__=!0}var r=/^[\s\n\r]+/;n.prototype={done:function(t){return this._queue.push(t),this},log:function(t){return t=t||"",this.done(function(e,n){return console.log("elenpi.log : ",t,e,n),e})},regExp:function(t,e,n){return this.done(function(r,i,s){if(!r)return e?r:!1;var o=t.exec(r);return o?(n&&("string"==typeof n?i[n]=o[0]:n.call(this,i,o,s)),r.substring(o[0].length)):e?r:!1})},"char":function(t,e){return this.done(function(n){return n?n[0]===t?n.substring(1):e?n:!1:!1})},xOrMore:function(e,n,r,i){return i=i||0,this.done(function(s,o,a){for(var u=[],c=!0,l=0;c&&s;){var h=e?this.createDescriptor?this.createDescriptor():{}:o;c=t(s,n,h,this,a),c!==!1&&(l++,s=c,h.skip||u.push(h),r&&s&&(c=t(s,r,h,this,a),c!==!1&&(s=c)))}return i>l?!1:(e&&u.length&&(o[e]=u),s)})},zeroOrMore:function(t,e,n){return this.xOrMore(t,e,n,0)},oneOrMore:function(t,e,n){return this.xOrMore(t,e,n,1)},zeroOrOne:function(e,n){return 1===arguments.length&&(n=e,e=null),this.done(function(r,i,s){if(!r)return r;var o=e?this.createDescriptor?this.createDescriptor():{}:i,a=t(r,n,o,this,s);return a!==!1&&(e&&(i[e]=o),r=a),r})},oneOf:function(e,n,r){return 1===arguments.length&&(n=e,e=null),this.done(function(i,s,o){if(!i)return!1;for(var a=0;a<n.length;){var u=e?this.createDescriptor?this.createDescriptor():{}:s,c=t(i,n[a],u,this,o);if(c!==!1)return e&&(s[e]=u),c;a++}return r?i:!1})},rule:function(e){return this.done(function(n,r,i){var s=this.rules[e];if(!s)throw new Error("elenpi.Rule :  rules not found : "+e);return t(n,s,r,this,i)})},skip:function(){return this.done(function(t,e){return e.skip=!0,t})},space:function(t){return this.done(function(e){if(!e)return t?!1:e;var n=(this.rules.space||r).exec(e);return n?e.substring(n[0].length):t?!1:e})},end:function(t){return this.done(function(e){return e&&t?!1:e})}};var i=function(t,e){this.rules=t,this.defaultRule=e};i.prototype={exec:function(e,n,r,i){return r||(r=this.rules[this.defaultRule]),t(e,r,n,this,i)},parse:function(t,e,n){var r=this.createDescriptor?this.createDescriptor():{},i=this.exec(t,r,e,n);return i===!1||i&&i.length>0?!1:r}};var s={r:function(){return new n},Rule:n,Parser:i};"undefined"!=typeof e&&e.exports?e.exports=s:this.elenpi=s}()},{}],2:[function(t,e){var n=function(){};n.prototype={on:function(t,e,n){return t="object"==typeof t?t.type:t,this._events=this._events||{},(this._events[t]=this._events[t]||[]).push({fct:e,args:n}),this},off:function(t,e){if(t="object"==typeof t?t.type:t,!this._events||t in this._events==!1)return this;for(var n=this._events[t],r=0,i=n.length;i>r;++r)if(n[r].fct===e){this._events[t].splice(r,1);break}return this},once:function(t,e,n){this._events=this._events||{};var r=function(){this.off(t,r),e.apply(this,arguments)};return(this._events[t]=this._events[t]||[]).push({fct:r,args:n}),this},emit:function(t){if(!this._events||t in this._events==!1||!this._events[t].length)return this;for(var e=this._events[t].slice(),n=[].slice.call(arguments,1),r=0,i=e.length;i>r;r++)e[r].fct.apply(this,e[r].args?e[r].args.concat(n):n);return this}},e.exports=n},{}],3:[function(t,e){e.exports={getProp:function(t,e){var n=0;"$this"===e[0]&&(n=1);for(var r=t,i=n,s=e.length;s>i;++i)if(!r||void 0===(r=r[e[i]]))return;return r},deleteProp:function(t,e){var n=t,r=0;for(len=e.length-1;r<len;++r)if(n&&!(n=n[e[r]]))return;n&&delete n[e[r]]},setProp:function(t,e,n){for(var r,i=t,s=0,o=e.length-1;o>s;++s)i=i&&!i[e[s]]?i[e[s]]={}:i[e[s]];return i&&(r=i[e[s]],i[e[s]]=n),r},shallowMerge:function(t,e){for(var n in t)e[n]=t[n]},shallowCopy:function(t){if(t&&t.forEach)return t.slice();if(t&&"object"==typeof t){if(t instanceof RegExp||t instanceof Date)return t;var e={};for(var n in t)e[n]=t[n];return e}return t},copy:function(t){if(!t)return t;var e=null;if("function"==typeof t.clone)return t.clone();if(t.forEach){e=[];for(var n=0,r=t.length;r>n;++n)e.push(this.copy(t[n]))}else if(t&&"object"==typeof t){if(t instanceof RegExp||t instanceof Date)return t;e={};for(var i in t){var s=t[i];e[i]="object"==typeof s?this.copy(s):s}}else e=t;return e},array:{includes:function(t,e){return t.some(function(t){return t===e})},remove:function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]===e)return void t.splice(n,1)},randomize:function(t){return t?t.sort(function(){return.5-Math.random()}):null},insertAfter:function(t,e,n){var r=t.indexOf(e);if(-1===e)throw new Error("utils.array.insertAfter : ref not found.");r===t.length-1?t.push(n):t.splice(r+1,0,n)}}}},{}],4:[function(t,e){var n=function(t){return new n.Template(t)};n.api=t("./lib/api"),n.env=t("./lib/env"),n.utils=t("./lib/utils"),n.AsyncManager=t("./lib/async");var r=t("./lib/context");n.Context=r.Context,n.Env=r.Env,n.Filter=t("./lib/filter");var i=t("./lib/interpolable");n.interpolable=i.interpolable,n.Interpolable=i.Interpolable,n.Template=t("./lib/template"),n.toAPI=function(t,e){var r=n.api[t]=n.api[t]||{};return n.utils.shallowMerge(e,r),r},n.elenpi=t("elenpi"),n.listenerParser=t("./lib/parsers/listener-call"),n.html=t("./lib/parsers/html-to-template"),n.emmet=t("./lib/parsers/emmet-style"),t("./lib/output-engine/dom/engine"),n.Container=t("./lib/output-engine/dom/container"),n.Error=function(t,e,n){this.status=t,this.message=e,this.report=n},n.Error.prototype=new Error,e.exports=n},{"./lib/api":5,"./lib/async":6,"./lib/context":7,"./lib/env":8,"./lib/filter":9,"./lib/interpolable":10,"./lib/output-engine/dom/container":11,"./lib/output-engine/dom/engine":13,"./lib/parsers/emmet-style":15,"./lib/parsers/html-to-template":16,"./lib/parsers/listener-call":17,"./lib/template":21,"./lib/utils":22,elenpi:1}],5:[function(t,e){e.exports={}},{}],6:[function(t,e){function n(){this._async={count:0,errors:[],successes:[],fails:[],callbacks:[]}}function r(t){t._async.count--,t._async.count<=0&&i(t)}function i(t){for(var e=t._async,n=e.errors.length?e.fails:e.successes,r=e.errors.length?e.errors:t,i=0;i<n.length;i++)n[i](1===r.length?r[0]:r);t.emit&&t.emit("stabilised",t),e.successes=[],e.fails=[],e.errors=[]}function s(t,e){t&&t(),r(e)}var o=t("nomocas-utils/lib/emitter"),a=t("./utils");n.prototype={waiting:function(t){this._async.count++;var e=this,n=t.then(function(t){return r(e),t},function(t){throw e.env&&e.env.data.debug&&console.error("async waiting error : ",t),e._async.errors.push(t),r(e),t});return this.parent&&this.parent.waiting&&this.parent.waiting(n),n},delay:function(t,e){this._async.count++;var n=setTimeout(s,e,t,this);return this.parent&&this.parent.delay&&this.parent.delay(null,e),n},stabilised:function(){if(0===this._async.count)return Promise.resolve(this);var t=this._async;return new Promise(function(e,n){t.successes.push(e),t.fails.push(n)})}},a.shallowMerge(o.prototype,n.prototype),e.exports=n},{"./utils":22,"nomocas-utils/lib/emitter":2}],7:[function(t,e){function n(t,e,r,s){if(u.call(this),this.__yContext__=!0,this.data=void 0!==t?t:{},this.map={},e){if(this.parent=e,this.env=s?new n(s):e.env,r){var o=this;this.path=r,this.binds=[],this.parent.subscribe(r,function(t){o.reset(t)},!1,this.binds)}}else this.env=s?s.__yContext__?s:new i(s):n.env}function r(t,e,n,r){return function(){t.destroyed||t.unsubscribe(e,n,r)}}function i(t,e,r){n.call(this,t,e,r),delete this.env}function s(t,e,n,r,i){for(var s=0,o=t._upstreams.length;o>s;++s){var a=t._upstreams[s];if(a){var u=a.call(this,r,e,n,i);u&&u.then&&this.waiting(u)}else o=t._upstreams.length}}var o=t("./utils"),a=t("./env"),u=t("./async"),c=/^\$/;n.prototype={destroy:function(){this.binds&&this.binds.forEach(function(t){t()}),this.destroyed=!0,this.binds=null,this.parent=null,this.data=null,this.map=null},get:function(t){switch(t.forEach||(t=t.split(".")),t[0]){case"$this":if(1===t.length)return this.data;break;case"$parent":if(!this.parent)throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));return this.parent.get(t.slice(1));case"$env":return this.env.get(t.slice(1))}var e=o.getProp(this.data,t);return void 0===e?"":e},call:function(t){var e=this.get(t),n=[].slice.call(arguments,1);if(!e)throw new Error("Context.call : no method found with : "+t);return e.apply(this,n)},dependent:function(t,e,n){var r,i=[],s=this,o=0;return this.binds=this.binds||[],e.forEach(function(e){i.push(this.get(e));var a=o++;this.subscribe(e,function(e){i[a]=e,r||(r=s.delay(function(){r&&(r=null,s.set(t,n.apply(s,i)))},0))},!1,this.binds)},this),this.set(t,n.apply(this,i)),this},reset:function(t){return"undefined"==typeof t&&(t={}),t===this.data||this.data instanceof Date&&t instanceof Date&&this.data.valueOf()===t.valueOf()?this:(this.data=t,this.notifyAll("reset",null,null,this.data,"*"),this)},set:function(t,e){if(1===arguments.length){for(var n in t)this.set(n,t[n]);return this}switch(t.forEach||(t=t.split(".")),t[0]){case"$this":if(1===t.length)return this.reset(e);t.shift();break;case"$parent":if(this.parent)return this.parent.set(t.slice(1),e)&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));case"$env":return this.env.set(t.slice(1),e)&&this}var r=o.setProp(this.data,t,e);if(r!==e){if(r instanceof Date&&r==e)return this;this.notify("set",t,e,t[t.length-1])}return this},toggle:function(t){return this.set(t,!this.get(t)),this},toggleInArray:function(t,e){for(var n=this.get(t),r=0,i=n.length;i>r;++r)if(n[r]===e)return this.del(t+"."+r),this;return this.push(t,e)},push:function(t,e){switch(t.forEach||(t=t.split(".")),t[0]){case"$parent":if(this.parent)return this.parent.push(t.slice(1),e)&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));case"$env":return this.env.push(t.slice(1),e)&&this}var n;if(n="$this"===t[0]?this.data:o.getProp(this.data,t),n||(n=[],o.setProp(this.data,t,n)),!n.forEach)throw console.error(t,"is not array at context.push : ",n),new Error("yamvish.Context : Object is not array at "+t.join(".")+" : couldn't push object.");return n.push(e),this.notify("push",t,e,n.length-1),this},del:function(t){switch(t=t.forEach?t.slice():t.split("."),t[0]){case"$parent":if(this.parent)return this.parent.del(t.slice(1))&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));case"$env":return this.env.del(t.slice(1))&&this}var e=t.slice(),n=e.pop(),r=e.length?o.getProp(this.data,e):this.data;if(r)if(r.forEach){var i=parseInt(n,10);i<r.length&&this.notify("removeAt",e,r.splice(i,1),i)}else{var s=r[n];delete r[n],this.notify("delete",t,s,n)}return this},subscribe:function(t,e,n,i){t.forEach||(t=t.split("."));var s;switch(t[0]){case"$this":s=this.map;break;case"$env":return this.env.subscribe(t.slice(1),e,n,i);case"$parent":if(!this.parent)throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));return this.parent.subscribe(t.slice(1),e,n,i);default:s=o.getProp(this.map,t)}return n?s?(s._upstreams=s._upstreams||[]).push(e):o.setProp(this.map,t,{_upstreams:[e]}):s?(s._listeners=s._listeners||[]).push(e):o.setProp(this.map,t,{_listeners:[e]}),i&&i.push(r(this,t,e,n)),this},unsubscribe:function(t,e,n){if(this.destroyed)return this;t.forEach||(t=t.split("."));var r;switch(t[0]){case"$this":r=this.map;break;case"$parent":return this.env.unsubscribe(t.slice(1),e,n)&&this;case"$parent":if(this.parent)return this.parent.unsubscribe(t.slice(1),e,n)&&this;throw new Error("yamvish.Context : there is no parent in current context. could not find : "+t.join("."));default:r=o.getProp(this.map,t)}if(!r)return this;for(var i=n?r._upstreams:r._listeners,s=0,a=i.length;a>s;++s)if(i[s]===e){i.splice(s,1);break}return this},notifyAll:function(t,e,n,r,i){if(n=n||this.map,n._listeners)for(var s=0,o=n._listeners.length;o>s;++s){var a=n._listeners[s];if(a){var u=a.call(this,r,t,e,i);u&&u.then&&this.waiting(u)}else o=n._listeners.length}if("push"!==t&&"removeAt"!==t)for(var c in n)"_listeners"!==c&&"_upstreams"!==c&&this.notifyAll(t,e?e.concat(c):e,n[c],r&&"object"==typeof r?r[c]:r,c);return this},notify:function(t,e,n,r){if(e.forEach||(e=e.split(".")),"$this"===e[0])e=e.slice(1);else if("$parent"===e[0]){if(!this.parent)throw new Error("could not notify parent : no parent found. for : "+e.join("."));return this.parent.notify(t,e.slice(1),n,r),this}for(var i,o=this.map,a=0,u=e.length;u>a&&(i=o["*"],i&&i._upstreams&&s.call(this,i,t,e,n,r),o=o[e[a]]);++a)o._upstreams&&s.call(this,o,t,e,n,r);return i&&this.notifyAll(t,e,i,n,r),o&&this.notifyAll(t,e,o,n,r),this},setAsync:function(t,e){var n=this;return this.waiting(e.then(function(e){return n.set(t,e),e},function(t){throw console.error("error while Context.setAsync : ",t),t}))},pushAsync:function(t,e){var n=this;return this.waiting(e.then(function(e){return n.push(t,e),e},function(t){throw console.error("error while Context.pushAsync : ",t),t}))},onAgora:function(t,e){var n=this.env.data.agora;return n.on(t,e,[this]),(this.binds=this.binds||[]).push(function(){n.off(t,e)}),this},toAgora:function(t){var e=[t].concat([].slice.call(arguments,1));return this.env.data.agora.emit.apply(this.env.data.agora,e),this},output:function(){var t={};for(var e in this.data)c.test(e)||(t[e]=this.data[e]);return t},clone:function(t){return new n(o.copy(this.data),this.parent,this.path,t?this.env.clone():this.env)},waitUntil:function(t,e){var n=this.get(t),r=this;if(n)e(n);else{var i=function(n){n&&(e(n),r.unsubscribe(t,i,!0))};this.subscribe(t,i,!0)}return this}},o.shallowMerge(u.prototype,n.prototype),i.prototype=new n,i.prototype.clone=function(){return new i(this.data.clone())},n.env=new i(a),e.exports={Context:n,Env:i}},{"./async":6,"./env":8,"./utils":22}],8:[function(t,e){(function(n){var r="undefined"==typeof window&&"undefined"==typeof document,i=t("nomocas-utils/lib/emitter"),s={isServer:r,debug:!0,expressionsGlobal:r?n:window,factory:r?null:document,agora:new i,clone:function(t){var e={};for(var n in this)"agora"!==n||t?e[n]=this[n]:e.agora=new i;return e}};e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"nomocas-utils/lib/emitter":2}],9:[function(t,e){function n(t){this._queue=t?t._queue.slice():[]}var r=/^(?:[\w'"\(\),]+\s*){0,10}/;n.prototype={call:function(t,e){for(var n=0,r=this._queue.length;r>n;++n)e=this._queue[n].call(t,e);return e},lower:function(){return this._queue.push(function(t){return t.toLowerCase()}),this},upper:function(){return this._queue.push(function(t){return t.toUpperCase()}),this},json:function(t){return this._queue.push(function(e){return JSON.stringify.apply(JSON,t?[e,null," "]:[e])}),this},truncate:function(){return this._queue.push(function(t){var e=r.exec(t);return e?e[0]+"...":t}),this},randomizeArray:function(){return this._queue.push(function(t){return t?t.forEach?t.sort(function(){return.5-Math.random()}):t:null}),this},urlencode:function(){return this._queue.push(function(t){return encodeURI(t)}),this}},e.exports=n},{}],10:[function(t,e){function n(t,e){try{return t.call(e.data,e,e.env.data.expressionsGlobal)}catch(n){return console.error("interpolable error : ",t.expression||n),console.error(n.stack),""}}function r(t,e,n){var r=t+e;if(h[r])return n.push.apply(n,h[r].dependencies),h[r].func;var i=[],s=t.replace(u,function(t){if("true"==t||"false"==t||"null"==t)return t;switch(t[0]){case'"':case"'":return t;case"$":if("."===t[1])return"__global"+t.substring(1);default:return"("===t[t.length-1]?(i.push(t.substring(0,t.length-1)),"__context.data."+t):(i.push(t),'__context.get(["'+t.split(".").join('","')+'"])')}});n.push.apply(n,i);var o=new Function("__context","__global","return "+s+";");if(!e)return h[r]={func:o,dependencies:i},f.debug&&(o.expression=t),o;var c=new Function("Filter","return new Filter()."+e)(a),l=function(t,e){return c.call(t,o.call(this,t,e))};return f.debug&&(l.expression=t),h[r]={func:l,dependencies:i},l}function i(t,e,r,i,s){return function(){var o=t.results[i];t.results[i]=n(r,e),o!==t.results[i]&&(1===t.dependenciesCount?s(t.output(e),"set"):t.willFire||(t.willFire=e.delay(function(){t.willFire&&(t.willFire=null,s(t.output(e),"set"))},0)))}}function s(t){var e=n(this.parts[1].func,t);return"undefined"!=typeof e||this._strict?e:""}function o(t){return function(){t.destroy()}}var a=t("./filter"),u=/true|false|null|\$\.(?:[a-zA-Z]\w*(?:\.[\w\$]*)*)|\$(?:[a-zA-Z]\w*(?:\.[\w\$]*)*)\(?|"[^"]*"|'[^']*'|[a-zA-Z_]\w*(?:\.[\w\$]*)*\(?/g,c=/(\{{1,2})\s*(.+?)((?:(?:\s\|\s)(.+?))?)\s*(\}{1,2})/,l={},h={},p=function(t){this.outputed=!1,this.results=[],this.willFire=null,this.parts=t.parts,this.dependenciesCount=t.dependenciesCount,this.directOutput=t.directOutput,this._strict=t._strict,this.binds=[]};p.prototype={output:function(t){if(this.directOutput)return this.outputed?this.results[0]:(this.outputed=!0,this.results[0]=this.directOutput(t));for(var e="",r=!0,i=0,s=0,o=this.parts.length;o>s;s++)r?e+=this.parts[s]:(e+=this.outputed?this.results[i]:this.results[i]=n(this.parts[s].func,t),i++),r=!r;return this.outputed=!0,e},destroy:function(){for(var t=0,e=this.binds.length;e>t;++t)this.binds[t]()}};var f=function(t,e,n){this.__interpolable__=!0,this._strict=n||!1;var i;7===e.length&&""===e[0]&&""===e[6]&&(this.directOutput=s),this.parts=[],this.original=t,this.dependenciesCount=0;for(var o=e[0],a=0;void 0!==o&&(this.parts.push(o),a+1!==e.length);){var u=e[a+1];if(u.length!==e[a+5].length)throw new Error("interpolation need same number of brackets on both sides : "+t);var i=[];this.parts.push({binded:2===u.length,func:r(e[a+2],e[a+4],i),dep:i}),this.dependenciesCount+=i.length,a+=6,o=e[a]}};f.prototype={subscribeTo:function(t,e,n){for(var r=new p(this),s=0,a=!1,u=1,c=this.parts.length;c>u;u+=2){var l=this.parts[u];if(l.binded){a=!0;for(var h=i(r,t,l.func,s,e),f=l.dep,d=0,m=f.length;m>d;d++)t.subscribe(f[d],h,!1,r.binds)}s++}return a&&n&&n.push(o(r)),r},output:function(t){if(this.directOutput)return this.directOutput(t);for(var e="",r=!0,i=this.parts,s=0,o=i.length;o>s;++s){if(r)e+=i[s];else{var a=n(i[s].func,t);if("undefined"==typeof a){if(this._strict)return;e+=""}e+=a}r=!r}return e}},e.exports={interpolable:function(t,e){if("string"!=typeof t)return t;if(l[t])return l[t];var n=t.split(c);return 1==n.length?t:l[t]=new f(t,n,e)},Interpolable:f}},{"./filter":9}],11:[function(t,e){var n=t("../../utils"),r=t("nomocas-utils/lib/emitter"),i=function(t){this.__yContainer__=!0,this.parent=t,this.childNodes=[]};i.prototype=new r;var s={appendChildrenToFragment:function(t,e,n){this.parentNode=e,this.witness&&t.appendChild(this.witness),n&&n.push(this);for(var r=0,i=this.childNodes.length;i>r;++r){var s=this.childNodes[r];s.__yContainer__?s.appendChildrenToFragment(t,e,n):t.appendChild(s)}return this},empty:function(){return n.destroyChildren(this.childNodes,!0),this.childNodes=[],this},mount:function(t){return"string"==typeof t&&(t=document.querySelector(t)),this.mounted&&t===this.parentNode?(this.closing&&this.transitionIn&&this.transitionIn(),this):(n.emptyNode(t),this.appendTo(t))},appendTo:function(t){var e=t;if("string"==typeof t&&(t=document.querySelector(t)),this.mounted&&t===this.parentNode)return this.closing&&this.transitionIn&&this.transitionIn(),this;if(!t)throw new Error("could not mount container : no parent found with "+e);if(this.mounted=!0,t.__yContainer__)t.appendChild(this);else{this.witness&&t.appendChild(this.witness),this.parentNode=t;for(var n=0,r=this.childNodes.length;r>n;++n){var i=this.childNodes[n];i.__yContainer__?i.appendTo(t):t.appendChild(i)}}return this.emit("mounted",this),this},insertBeforeNode:function(t){if(!t.parentNode)throw new Error("insertBeforeNode error : given node has no parent.");this.mounted=!0;var e=document.createDocumentFragment(),n=[];this.appendChildrenToFragment(e,t.parentNode,n),t.parentNode.insertBefore(e,t);for(var r=0,i=n.length;i>r;++r)n[r].emit("mounted",this);return this},setWitness:function(t){this.witness=t},addWitness:function(t,e){return this.witness?this:(this.witness=document.createComment(t),e?(e.appendChild(this.witness),this):this.parentNode?(this.childNodes.length?this.parentNode.insertBefore(this.witness,this.firstChild):(console.warn("addWitness : container has been mounted without witness and children. Appending witness in parent.",this),this.parentNode.appendChild(this.witness)),this):this)},removeWitness:function(){return this.witness?(this.witness.parentNode&&this.witness.parentNode.removeChild(this.witness),this.witness=null,this):this},remount:function(){if(!this.witness.parentNode)throw new Error("container could not be remounted : witness has been unmounted.");if(this.mounted)return this.closing&&this.transitionIn&&this.transitionIn(),this;var t=this.witness.nextSibling;return t?this.insertBeforeNode(t):this.appendTo(this.witness.parentNode),this},doUnmount:function(t){if(this.mounted=!1,!this.parentNode)return this;this.witness&&!t&&this.parentNode.removeChild(this.witness);for(var e=0,n=this.childNodes.length;n>e;++e){var r=this.childNodes[e];r.__yContainer__?r.doUnmount():r.parentNode&&r.parentNode.removeChild(r)}return this.parentNode=null,this.emit("unmounted",this),this},unmount:function(t,e){if(!this.parentNode)return e&&e(this),this;if(!this._beforeUnmount)return this.doUnmount(t),e&&e(this),this;var n=this;return this._beforeUnmount(function(){n.doUnmount(t),e&&e(n)}),this},appendChild:function(t){if(this.parentNode){var e=this.nextSibling;e?t.__yContainer__?t.insertBeforeNode(e):this.parentNode.insertBefore(t,e):t.__yContainer__?t.appendTo(this.parentNode):this.parentNode.appendChild(t)}return this.childNodes.push(t),this},removeChild:function(t){if("object"!=typeof t){var e=t;if(t=this.childNodes[e],!t)throw new Error("container.removeChild not found : ",e);this.childNodes.splice(e,1)}else n.array.remove(this.childNodes,t);return this.parentNode&&(t.__yContainer__?t.unmount():this.parentNode.removeChild(t)),this},destroyer:function(){var t=this;return function(){t.destroy()}},destroy:function(){this.mounted=!1,this.emit("destroy",this),n.destroyElement(this,!0),this.destroyed=!0,this.comment=null,this.parentNode=null},hide:function(){return this.childNodes.forEach(function(t){return t.__yContainer__?t.hide():void(t.style&&(t.style.display="none"))}),this},show:function(){return this.childNodes.forEach(function(t){return t.__yContainer__?t.show():void(t.style&&(t.style.display=""))}),this},beforeUnmount:function(t){this._beforeUnmount=t}};Object.defineProperty(i.prototype,"nextSibling",{get:function(){if(!this.childNodes.length)return this.witness?this.witness.nextSibling:null;if(!this.parentNode)return null;var t=this.childNodes[this.childNodes.length-1];return t?t.nextSibling:null}}),Object.defineProperty(i.prototype,"firstChild",{get:function(){var t=this.childNodes[0];return t?t.__yContainer__?t.firstChild:t:null}}),Object.defineProperty(i.prototype,"lastChild",{get:function(){var t=this.childNodes[this.childNodes.length-1];return t?t.__yContainer__?t.lastChild:t:null}}),n.shallowMerge(s,i.prototype),e.exports=i},{"../../utils":22,"nomocas-utils/lib/emitter":2}],12:[function(t,e){function n(t,e,n){n?e.insertBefore(t,n):e.appendChild(t)}var r=t("../../utils"),i=t("./container"),s=t("../../context").Context,o=t("./switcher"),a=function(t,e,n,r){var i=new u(t,e,n[1],n[2],r),s=n[0];if("string"==typeof s){e.binds=e.binds||[],i.varPath=s;var o=s.split(".");t.subscribe(s,function(t,e,n,r){switch(e){case"delete":i.updateArray([]);break;case"reset":case"set":i.updateArray(t);break;case"push":i.pushItem(t,r);break;case"removeAt":i.deleteItem(r)}},!1,e.binds),t.subscribe(s+".*",function(t,e,n,r){var s=n.slice(o.length);i.updateItem(e,s.slice(1),t,r,s[0])},!0,e.binds),s=t.get(s)}i.updateArray(s)},u=function(t,e,n,r,s){this.itemTemplate=n,this.itemsContainer=new i,this.parentContainer=s;var a=[{value:"items",container:this.itemsContainer}];r&&a.push({value:"empty",template:r}),o.call(this,t,e,s,a)};u.prototype={_createItem:function(t,e){var n=new s(t,this.context),r=this,i=this.itemTemplate.toContainer(n,this.parentContainer);return i.context=n,n.index=e,n.path=r.varPath+"."+e,i},updateArray:function(t){if(!t||!t.length)return this["switch"]("empty"),void(this.itemsContainer&&this.itemsContainer.empty());this["switch"]("items");for(var e=this.itemsContainer.childNodes,r=0,i=Math.min(e.length,t.length);i>r;++r)e[r].context.reset(t[r]);if(i<e.length){i=e.length;for(var s=r;i>r;++r)e[r].destroy();e.splice(s)}else if(i<t.length){var o=this.itemsContainer.parentNode?document.createDocumentFragment():null;for(i=t.length;i>r;++r){var a=this._createItem(t[r],r);e.push(a),o&&a.appendChildrenToFragment(o,this.itemsContainer.parentNode)}o&&n(o,this.itemsContainer.parentNode,this.itemsContainer.childNodes.length?this.itemsContainer.nextSibling||this.witness.nextSibling:this.witness.nextSibling)}},updateItem:function(t,e,n,r){var i=this.itemsContainer.childNodes[r];i&&(e.length?i.context.set(e,n):i.context.reset(n))},pushItem:function(t,e){this["switch"]("items");var n=this._createItem(t,e),r=this.witness.nextSibling;return this.itemsContainer.childNodes.length||!r?this.itemsContainer.appendChild(n):void(r&&(n.insertBeforeNode(r),this.itemsContainer.childNodes.push(n)))},deleteItem:function(t){var e=this.itemsContainer.childNodes[t];e.doUnmount();var n=this.itemsContainer.childNodes;if(n.splice(t,1),n.length)for(var r=t,i=n.length;i>r;++r)n[r].context.index=r,n[r].context.path=this.varPath+"."+r;else this["switch"]("empty")}},r.shallowMerge(o.prototype,u.prototype),e.exports={Each:u,each:a}},{"../../context":7,"../../utils":22,"./container":11,"./switcher":14}],13:[function(t,e){function n(t,e,n,r){var i=t.split("."),s={actor:n,name:t};if(2==i.length){switch(i[0]){case"context":s.actor=e;break;case"container":s.actor=r;break;default:throw new Error("unrecognized template.on event path : "+t)}s.name=i[1]}return s}function r(t,e,n,r){for(var i,s=e[0],o=0;s;){switch(i=null,s.type){case"*":i=c[s.handler];break;case"dom":case"context":i=s.handler;break;case"custom":i=s.handler.dom}if(i){if(i.__yTemplate__?i.toDOM(t,t.context||n,r):i(t.context||n,t,s.args,r),s.suspendAfter)break;s=e[++o]}else s=e[++o]}}var i=t("../../utils"),s=t("./container"),o=t("../../context").Context,a=t("../../template"),u=t("./switcher"),c={each:t("./each").each,eachTemplates:function(t,e,n,r){var i=n[0],s=n[1];i.forEach(function(n){(s?s(n):n).toDOM(e,t,r)})},"if":function(t,e,n,r){var i=n[0],s=i,o=n[1],a=n[2];i&&i.__interpolable__?s=i.output(t):"function"==typeof i&&(s=i.call(this,t)),s?o.toDOM(e,t,r):a&&a.toDOM(e,t,r)},container:function(t,e,n,r){var i=n[0],s=n[1],o=s.toContainer(t,r).appendTo(e);i.lateMount?o.addWitness(i.lateMount,e):o.appendTo(e)},lateMount:function(t,e,n,r){var i=n[0],s=n[1],o=document.createComment("late mount");e.appendChild(o),i(t,s,o,r)},agoraView:function(t,e,n,r){var i=n[0],s=n[1];c.lateMount(t,e,[function(t,e,n,r){var s;t.onAgora(i+":toggle",function(t,e){s&&s.mounted&&!s.closing?t.toAgora(i+":hide",e):t.toAgora(i+":show",e)}),t.onAgora(i+":show",function(t,i){s||(s=y().view(e).toContainer(t,r),s.setWitness(n)),i&&s.context.set(i),s.remount()}),t.onAgora(i+":hide",function(t,e){s&&(e&&s.context.set(e),s.mounted&&s.unmount(!0))})},s,r])},mountIf:function(t,e,n,r){var i=n[0],s=[{value:!0,template:n[1]}];n[2]&&s.push({value:!1,template:n[2]});var o=new u(t,e,r,s);o.expression(i)},"switch":function(t,e,n,r){var i=n[0],s=n[1],o=[];for(var a in s)"default"!==a&&o.push({value:a,template:s[a]});var c=new u(t,e,r,o,s["default"]);c.expression(i)},newContext:function(t,e,n){var r=n[0],i=n[1]||t,s=n[2];e.context=new o(r,i,s)},"with":function(t,e,n,r){var i=n[0],s="string"==typeof i,a=s?t.get(i):null,u=n[1],c=new o(a,t,s?i:null);if(c.binds=c.binds||[],s){var l=i.split(".");t.subscribe(i,function(t,e,n){if(!this.freezed){var r=n.slice(l.length).join(".");switch(e){case"reset":c.reset(t);break;case"set":c.set(r,t);break;case"push":c.push(r,t);break;case"removeAt":case"delete":c.del(r)}}},!0,c.binds)}u.toDOM(e,c,r)},tag:function(t,e,n,r){var i=n[0],s=n[1],o=document.createElement(i);s.toDOM(o,t,r),e.appendChild(o)},text:function(t,e,n){var r,i,s=n[0];s.__interpolable__?(r=s.output(t),i=document.createTextNode(r),i.binds=i.binds||[],s.subscribeTo(t,function(t){r!==t&&(i.nodeValue=t,r=t)},i.binds)):i=document.createTextNode(s),e.appendChild(i)},br:function(t,e){e.appendChild(document.createElement("br"))},attr:function(t,e,n){var r=n[0],i=n[1],s=n[1];if(i&&i.__interpolable__){s=i.output(t);var o=function(t){e.setAttribute(r,t)};e.binds=e.binds||[],i.subscribeTo(t,o,e.binds)}e.setAttribute(r,s)},prop:function(t,e,n){var r=n[0],i=n[1],s=n[1],o=function(t){e[r]=t?!0:!1};i&&i.__interpolable__&&(s=i.output(t),e.binds=e.binds||[],i.subscribeTo(t,o,e.binds)),o(s)},val:function(t,e,n){var r=n[0],i=n[1],s=i;i.__interpolable__?(e.addEventListener("input",function(e){var n=e.target.value;s!==n&&(s=n,t.set(r,e.target.value))}),e.binds=e.binds||[],s=i.output(t),i.subscribeTo(t,function(t){t!==s&&(e.value=t,s=t)},e.binds),e.setAttribute("value",s)):e.setAttribute("value",i)},contentEditable:function(t,e,n){var r,s,o=n[0],a=n[1],u=n[2],c=n[3],l=n[4];if(a.__interpolable__){s=a.output(t);var h=function(e){var n=i.castNodeValueTo(e.target,c);s!==n&&(s=n,r=!0,t.set(o,s),r=!1)},p=!0;u&&u.__interpolable__&&(p=u.output(t),u.subscribeTo(t,function(t){t!=p&&(p=t,t?e.addEventListener(l,h):e.removeEventListener(l,h),e.setAttribute("contenteditable",!!t))})),p&&(e.addEventListener(l,h),e.setAttribute("contenteditable",!0)),e.binds=e.binds||[],a.subscribeTo(t,function(t){r||t===s||(s=t,e.textContent=t)},e.binds)}else s=a;e.textContent=s},setClass:function(t,e,n){var r=n[0],s=n[1],o=r,a=s,u=function(t){a=t,t?e.classList.add(o):e.classList.remove(o)};if(r.__interpolable__){var c=function(t){a&&(i.removeClass(e,o),i.setClass(e,t)),o=t};e.binds=e.binds||[],r.subscribeTo(t,c,e.binds),o=r.output(t)}s.__interpolable__?(e.binds=e.binds||[],s.subscribeTo(t,u,e.binds),u(s.output(t),"set")):u(s,"set")},css:function(t,e,n){var r=n[0],i=n[1],s=i;i.__interpolable__&&(s=i.output(t),e.binds=e.binds||[],i.subscribeTo(t,function(t){e.style[r]=t},e.binds)),e.style||(e.style={}),e.style[r]=s},visible:function(t,e,n){var r=n[0],i=r,s=(e.style?e.style.display:"")||"";e.style||(e.style={}),r.__interpolable__&&(i=r.output(t),e.binds=e.binds||[],r.subscribeTo(t,function(t){e.__yContainer__?t?e.show():e.hide():e.style.display=t?s:"none"},e.binds)),e.__yContainer__?i?e.show():e.hide():e.style.display=i?s:"none"},on:function(t,e,r,i){var s=n(r[0],t,e,i);if(s.actor.on)s.actor.on(s.name,r[1],[t]);else if(s.actor.addEventListener){var o=function(e){r[1].call(t,e)};s.actor.addEventListener(s.name,o)}},once:function(t,e,r,i){var s=n(r[0],t,e,i);if(s.actor.once)s.actor.once(s.name,r[1],[t]);else if(s.actor.addEventListener){var o=function(e){s.actor.removeEventListener(s.name,o),r[1].call(t,e)};s.actor.addEventListener(s.name,o)}},off:function(t,e,r){var i=n(r[0],t,e,container);i.actor.off?i.actor.off(i.name,r[1]):i.actor.removeEventListener&&i.actor.removeEventListener(i.name,r[1])},client:function(t,e,n,r){t.env.data.isServer||n[0].toDOM(e,t,r);

},server:function(t,e,n,r){t.env.data.isServer&&n[0].toDOM(e,t,r)},log:function(t,e,n,r){console.log(n[0]||""),console.log("-> context",t),console.log("-> node",e),console.log("-> container",r)},suspendUntil:function(t,e,n,r){var i,s=n[0],o=n[1],u=n[2],c=s.__interpolable__?s.output(t):s,l=new a(u._queue.slice(o));c?l.toDOM(e,t,r):s.__interpolable__&&(i=s.subscribeTo(t,function(n){n&&(i.destroy(),l.toDOM(e,t,r))}))}};a.prototype.toDOM=function(t,e,n){e=e||new o,r(t,this._queue,e,n)},a.prototype.toContainer=function(t,e){t=t||new o;var n=new s(e);return 1===this._queue.length&&this._queue[0].asContainer?this._queue[0].args[1].toContainer(t,n):(r(n,this._queue,t,n),n)},e.exports=c},{"../../context":7,"../../template":21,"../../utils":22,"./container":11,"./each":12,"./switcher":14}],14:[function(t,e){var n=t("../../utils"),r=t("../../interpolable").interpolable,i=function(t,e,n,r,i){this.witness=document.createComment("switcher"),e.appendChild(this.witness),this.node=e,this.context=t,this.items=r,this.defaultTemplate=i};i.prototype={expression:function(t){if(t=r(t),t.__interpolable__){var e=this;t.subscribeTo(this.context,function(t){e["switch"](t)}),this["switch"](t.output(this.context))}else this["switch"]("function"==typeof t?t(this.context):t)},"switch":function(t){var e=this,n=this.items.some(function(n){return n.value==t?(n.container||(n.container=n.template.toContainer(e.context)),e._mount(n.container),!0):void 0});n||(this.defaultTemplate?(this.defaultContainer||(this.defaultContainer=this.defaultTemplate.toContainer(this.context)),e._mount(this.defaultContainer)):e._unmountCurrent())},_unmountCurrent:function(){this.currentContainer&&(this.node.__yContainer__?this.node.removeChild(this.currentContainer):this.currentContainer.unmount(),this.currentContainer=null)},_mount:function(t){if(this.currentContainer!==t){if(this._unmountCurrent(),this.currentContainer=t,this.node.__yContainer__&&!this.node.parentNode)return void n.array.insertAfter(this.node.childNodes,this.witness,t);var e=this.witness.nextSibling;e?t.insertBeforeNode(e):t.appendTo(this.witness.parentNode)}}},e.exports=i},{"../../interpolable":10,"../../utils":22}],15:[function(t,e){var n=t("elenpi"),r=n.r,i=n.Parser,s=t("../template"),o={emmet:r().regExp(/^([\w-_]+)\s*/,!1,function(t,e){t.tagName=e[1]}).zeroOrMore("attrs",r().oneOf(["class","yam","id","text","attr"])),"class":r().regExp(/^\./,!1,function(t){t.isClass=!0,t.xpr=[]}).rule("interpolable").rule("endExpression"),id:r().regExp(/^#/,!1,function(t){t.isID=!0,t.xpr=[]}).rule("interpolable"),attr:r().regExp(/^[\w-]+/,!1,function(t,e){t.isAttr=!0,t.name=e[0],t.xpr=[]}).rule("endExpression"),endExpression:r().zeroOrOne(null,r().regExp(/^\s*\(\s*([^\)]*)\s*\)\s*/,!1,function(t,e){t.xpr.push(e[1])})),interpolable:r().regExp(/^\{{1,2}[^\}]+\}{1,2}|[\w-_]+/,!1,function(t,e){t.xpr.push(e[0])}).space(),text:r().regExp(/^~([^~]*)$/,!1,function(t,e){t.isText=!0,t.text=e[1]}),yam:r().regExp(/^y:([\w-_]+)/,!1,function(t,e){t.isYam=!0,t.name=e[1],t.xpr=[]}).rule("endExpression")},a=new i(o,"emmet");a.toTemplate=function(t,e,n){var r=this.parse(t);if(!r)throw new Error("emmet style badly formatted : "+t);for(var i=new s,o=0,a=r.attrs.length;a>o;++o){var u=r.attrs[o];if(u.isClass)i.cl(u.xpr[0],u.xpr[1]);else if(u.isID)i.id(u.xpr[0]);else if(u.isText)i.text(u.text);else if(u.isYam){if(!i[u.name])throw new Error("emmet parsing : no template method found with : ",u.name);i[u.name].apply(i,u.xpr)}else i.attr(u.name,u.xpr[0])}return n=[r.tagName,i].concat(n||[]),e=e||new s,e.tag.apply(e,n)},s.prototype.emmet=function(t){return a.toTemplate(t,this,[].slice.call(arguments,1)),this},e.exports=a},{"../template":21,elenpi:1}],16:[function(t,e){function n(t,e,n,r){var i,s=e.indexOf("</"+t+">");if(-1===s)throw new Error(t+" tag badly closed.");return s&&(i=e.substring(0,s),"templ"===t?r.templFunc=new Function(i):r.raw(i)),e.substring(s+t.length+3)}var r=t("elenpi"),i=r.r,s=r.Parser,o=t("../template"),a=t("./string-to-template"),u=(t("../api"),/^([\w-_]+)\s*(?:=\s*("([^"]*)"|[\w-_]+|\{\{[^\}]+\}\}|\{[^\}]+\}))?\s*/),c=/if|each|with|mountIf/,l=/client|server|view|container/,h=/[\w\.\$_-]+\:[\w\.\$_-]+/,p=new RegExp("^<("+c.source+"|"+l.source+"|"+h.source+")\\s*"),f=t("./open-tags"),d=/^(?:script|style|code|templ)/,m={document:i().zeroOrMore(null,i().space().rule("comment")).regExp(/^\s*<!DOCTYPE[^>]*>\s*/i,!0).rule("children").space(),comment:i().regExp(/^<!--(?:.|\s)*?(?=-->)-->/,!1,function(){}),tagEnd:i().regExp(/^\s*<\/([\w:-_]+)\s*>/,!1,function(t,e){if(t.tagName!==e[1])throw new Error("tag badly closed : "+e[1]+" - (at opening : "+t.tagName+")")}),children:i().zeroOrMore(null,i().oneOf([i().space().rule("comment"),i().space().rule("yamTag"),i().space().rule("tag"),i().rule("text")])),text:i().regExp(/^[^<]+/,!1,function(t,e){t.text(e[0])}),tag:i().regExp(/^<([\w-_]+)\s*/,!1,function(t,e){t.tagName=e[1]}).done(function(t,e){return e._innerTemplate=new o,this.exec(t,e._innerTemplate,this.rules.attributes)}).oneOf([i()["char"](">").done(function(t,e){if(f.test(e.tagName))return t;if(d.test(e.tagName))return n(e.tagName,t,e,e._innerTemplate);var r=this.exec(t,e._innerTemplate,this.rules.children);return r===!1?!1:this.exec(r,e,this.rules.tagEnd)}),i().regExp(/^\/>/)]).done(function(t,e){return"yield"===e.tagName&&(e.tagName="__yield"),"templ"!==e.tagName?e.tag(e.tagName,e._innerTemplate):e.use(e._innerTemplate.templFunc),e._innerTemplate=null,e.tagName=null,t}),yamTagPath:i().regExp(/^([\w-_$]+|\{{1,2}[^\}]*\}{1,2})/,!1,function(t,e){t.path=e[1]}),yamTag:i().regExp(p,!1,function(t,e){t.tagName=e[1]}).done(function(t,e){var n={};return e.attrMap=n,e.tagName.match(c)?this.exec(t,n,this.rules.yamTagPath):e.tagName.match(l)?t:this.exec(t,n,this.rules.attributesMap)}).space().oneOf([i()["char"](">").done(function(t,e){var n=e._innerTemplate=new o,r=this.exec(t,n,this.rules.children);return r===!1?!1:this.exec(r,e,this.rules.tagEnd)}),i().regExp(/^\/>/)]).done(function(t,e){var n=e.tagName,r=e.attrMap,i=e._innerTemplate;switch(n){case"if":case"each":case"with":case"mountIf":e[n](r.path,i);break;case"client":case"server":case"view":case"container":e[n](i);break;default:e.use(n,r,i)}return e._innerTemplate=null,e.attrMap=null,e.tagName=null,t}),attributesMap:i().zeroOrMore(null,i().regExp(u,!1,function(t,e){t[e[1]]=void 0!==e[3]?e[3]:void 0!==e[2]?e[2]:""}).space()),attributes:i().zeroOrMore(null,i().regExp(u,!1,function(t,e){var n=e[1],r=void 0!==e[3]?e[3]:void 0!==e[2]?e[2]:"";switch(n){case"class":if(!r)break;r.split(/\s+/).forEach(function(e){e&&t.cl(e)});break;case"data-template":if(!r)break;var i=a.parseTemplate(r);if(i===!1)throw new Error("data-template attribute parsing failed : "+r);t._queue=t._queue.concat(i._queue);break;default:t.attr(n,r)}}))},v=new s(m,"children");v.createDescriptor=function(){return new o},e.exports=v},{"../api":5,"../template":21,"./open-tags":18,"./string-to-template":20,elenpi:1}],17:[function(t,e){var n=t("elenpi"),r=n.r,i=n.Parser,s=t("./primitive-argument-rules"),o={path:r().oneOrMore(null,r().regExp(/^[\w-_\$]+/,!1,function(t,e){(t.path=t.path||[]).push(e[0])}),r().regExp(/^\./)),call:r().rule("path").done(function(t,e){return e.method=e.path,e.path=null,e.arguments=[],t}).zeroOrOne(null,r().regExp(/^\s*\(\s*/).zeroOrMore(null,r().oneOf(["integer","float","bool","singlestring","doublestring",r().rule("path").done(function(t,e){return e.arguments.push(e.path),e.path=null,t})]),r().regExp(/^\s*,\s*/)).regExp(/^\s*\)/))};for(var a in s)o[a]=s[a];var u=new i(o,"call");u.parseListener=function(t){var e=this.parse(t);if(!e.method)throw new Error("yamvish listener badly formatted : "+t);return function(n){var r=this.get(e.method);if(!r)throw new Error("yamvish listener not found : "+t);if(!e.arguments)return r.call(this,n);for(var i=[n],s=0,o=e.arguments.length;o>s;++s){var a=e.arguments[s];i.push(a.forEach?this.get(a):a)}return r.apply(this,i)}},e.exports=u},{"./primitive-argument-rules":19,elenpi:1}],18:[function(t,e){e.exports=/(br|input|img|area|base|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)/},{}],19:[function(t,e){var n=t("elenpi").r,r={doublestring:n().regExp(/^"([^"]*)"/,!1,function(t,e){t.arguments.push(e[1])}),singlestring:n().regExp(/^'([^']*)'/,!1,function(t,e){t.arguments.push(e[1])}),"float":n().regExp(/^[0-9]*\.[0-9]+/,!1,function(t,e){t.arguments.push(parseFloat(e[0],10))}),integer:n().regExp(/^[0-9]+/,!1,function(t,e){t.arguments.push(parseInt(e[0],10))}),bool:n().regExp(/^(true|false)/,!1,function(t,e){t.arguments.push("true"===e[1]?!0:!1)})};e.exports=r},{elenpi:1}],20:[function(t,e){function n(t){for(var e=new o,n=0,r=t.length;r>n;++n){var i=t[n];if(!e[i.method])throw new Error("no handler found in Template as : "+i.method);e[i.method].apply(e,i.arguments)}return e}var r=t("elenpi"),i=r.r,s=r.Parser,o=t("../template"),a=t("./primitive-argument-rules"),u={templates:i().space().zeroOrMore("calls",i().rule("template"),i().regExp(/^\s*\.\s*/)).done(function(t,e){var r;return e.calls&&(r=n(e.calls)),r&&e.arguments?(e.arguments.push(r),delete e.calls):e.calls=r,t}),template:i().regExp(/^[\w-_]+/,!1,function(t,e){t.method=e[0],t.arguments=[]}).zeroOrOne(null,i().regExp(/^\s*\(\s*/).zeroOrMore(null,i().oneOf(["integer","float","bool","singlestring","doublestring","templates"]),i().regExp(/^\s*,\s*/)).regExp(/^\s*\)/))};for(var c in a)u[c]=a[c];var l=new s(u,"templates"),h={};l.parseTemplate=function(t){if(void 0!==h[t])return h[t].calls;var e=h[t]=l.parse(t);return e===!1?!1:e.calls},e.exports=l},{"../template":21,"./primitive-argument-rules":19,elenpi:1}],21:[function(t,e){"use strict";function n(t,e){return Array.prototype.slice.call(t,e)}function r(t,e){var n=o();for(var r in t)n[e](r,t[r]);return n}function i(t){for(var e=o(),n=Object.keys(t),i=0,s=n.length;s>i;i++){var a=n[i],u=t[a];switch(a){case"style":e.use(r(u,"css"));break;case"classes":e.use(r(u,"cl"));break;case"value":e.val(u);break;case"disabled":e.disabled(u);break;case"visible":e.visible(u);break;default:e.attr(a,u)}}return e}function s(t){this.__yTemplate__=!0,this._queue=t?t.forEach?t:t._queue.slice():[]}function o(){return new s}function a(t,e,n,r,i){return t._queue.push(i?{type:e,handler:n,args:r,suspendAfter:i}:{type:e,handler:n,args:r}),t}var u=t("./utils"),c=t("./interpolable").interpolable,l=(t("./context").Context,t("./api")),h=t("./parsers/listener-call");u.parseAttrMap=i,s.prototype={dom:function(t,e,n){return a(this,"dom",t,e,n)},string:function(t,e,n){return a(this,"string",t,e,n)},context:function(t,e,n){return a(this,"context",t,e,n)},exec:function(t,e,n){return"object"==typeof t?a(this,"custom",t,e,n):a(this,"*",t,e,n)},firstPass:function(t,e,n){return a(this,"firstPass",t,e,n)},secondPass:function(t,e,n){return a(this,"secondPass",t,e,n)},container:function(t,e){return t.__yTemplate__&&(e=t,t={}),this._queue.push({type:"*",handler:"container",args:[t,e],asContainer:!0}),this},view:function(t,e){return t.__yTemplate__&&(e=t,t={}),this.container(o().newContext(t.data,t.parent,t.path).use(e))},lateMount:function(t,e){return"string"==typeof e&&(e=o().use(e)),this.exec("lateMount",[t,e])},agoraView:function(t,e){return"string"==typeof e&&(e=o().use(e)),this.exec("agoraView",[t,e])},set:function(t,e){var n=arguments.length;return this.context(function(r){2===n?r.set(t,e):r.set(t)})},setAsync:function(t,e){return this.context(function(n){n.setAsync(t,e)})},dependent:function(t,e,n){return this.context(function(r){r.dependent(t,e,n)})},push:function(t,e){return this.context(function(n){n.push(t,e)})},pushAsync:function(t,e){return this.context(function(n){n.pushAsync(t,e)})},toggle:function(t){return this.context(function(e){e.toggle(t)})},toggleInArray:function(t){return this.context(function(e){e.toggleInArray(t)})},del:function(t){return this.context(function(e){e.del(t)})},newContext:function(t,e){return this.exec("newContext",[t,e])},"with":function(t,e){return this.exec("with",[t,e])},subscribe:function(t,e,n){return this.context(function(r){r.subscribe(t,e,n)})},unsubscribe:function(t,e,n){return this.context(function(r){r.unsubscribe(t,e,n)})},onAgora:function(t,e){return this.context(function(n){n.onAgora(t,e)})},offAgora:function(t,e){return this.context(function(n){n.offAgora(t,e)})},toAgora:function(t,e){return this.context(function(n){n.toAgora(t,e)})},attr:function(t,e){return this.exec("attr",[t,"undefined"!=typeof e?c(e):void 0])},prop:function(t,e){return this.exec("prop",[t,"undefined"!=typeof e?c(e):void 0])},id:function(t){return this.attr("id",t)},disabled:function(t){return this.exec("prop",["disabled",c(t)])},val:function(t){var e;if("string"==typeof t&&(t=c(t),t.__interpolable__)){if(t.dependenciesCount>1)throw new Error("template.val could only depend to one variable.");e=t.parts[1].dep[0]}return this.exec("val",[e,t])},html:function(t){return t=c(t),this.dom(function(e,n){var r=t,i=[],s=function(t){var e,r=document.createElement("div");"<"!==t[0]&&(t="<p>"+t+"</p>",e=!0),r.innerHTML=t,i.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),i=[];for(var s=e?r.firstChild:r,o=[].slice.call(s.childNodes),a=0,u=o.length;u>a;++a){var c=o[a];i.push(c),n.appendChild(c)}};t.__interpolable__&&(r=t.output(e),t.subscribeTo(e,function(t){s(t)})),s(r)}).string(function(e,n){var r=t.__interpolable__?t.output(e):t;"<"!==r[0]&&(r="<p>"+r+"</p>"),n.children+=r})},contentEditable:function(t,e,n,r){var i,e;if(e&&(e=c(e)),"string"==typeof t&&(t=c(t),t.__interpolable__)){if(t.dependenciesCount>1)throw new Error("template.contentEditable could only depend to one variable. : "+t.original);i=t.parts[1].dep[0]}return this.exec("contentEditable",[i,t,e,n||"text",r||"input"])},setClass:function(t,e){return e="undefined"==typeof e?!0:c(e),this.exec("setClass",[c(t),e])},css:function(t,e){return this.exec("css",[t,c(e)])},visible:function(t){return this.exec("visible",[c(t)])},text:function(t){return this.exec("text",[c(t)])},tag:function(t,e){var n,r=e&&"object"==typeof e&&!e.__yTemplate__?!0:!1;n=r?i(e):o();for(var s=r?2:1,a=arguments.length;a>s;++s)arguments[s]&&(arguments[s].__yTemplate__?n.use(arguments[s]):n.text(arguments[s]));return this.exec("tag",[t,n])},raw:function(t){return this.exec("raw",[t])},br:function(){return this.exec("br")},a:function(t){var e=n(arguments,1);return e.unshift("a","string"==typeof t?o().attr("href",t):t),this.tag.apply(this,e)},img:function(t){var e=n(arguments,1);return e.unshift("img","string"==typeof t?o().attr("src",t):t),this.tag.apply(this,e)},input:function(t,e){var r;if("string"==typeof t){r=n(arguments,2);var i=o().attr("type",t);e&&i.val(e),r.unshift("input",i)}else r=n(arguments);return this.tag.apply(this,r)},textarea:function(t,e,n){return this.tag("textarea",t,o().val(e).text(e).use(n))},h:function(t){var e=n(arguments,1);return e.unshift("h"+t),this.tag.apply(this,e)},space:function(){return this.exec("text",[" "])},nbsp:function(){return this.exec("text",[" "])},select:function(t,e,n){var r;if("string"==typeof t&&(t=c(t),t.__interpolable__)){if(t.dependenciesCount>1)throw new Error("template.val could only depend to one variable.");r=t.parts[1].dep[0]}return this.tag("select",o().attr("name",r).each(e,o().option("{{ label || val }}",o().val("{{  val }}").prop("selected","{{ val === $parent."+r+" }}")))["if"](t.__interpolable__,o().on("change",function(t){var e=t.target,n=e.options[e.selectedIndex].value;this.get(r)!==n&&this.set(r,n)})),n)},on:function(t,e){return"string"==typeof e&&(e=h.parseListener(e)),this.exec("on",[t,e])},once:function(t,e){return"string"==typeof e&&(e=h.parseListener(e)),this.exec("once",[t,e])},off:function(t,e){return"string"==typeof e&&(e=h.parseListener(e)),this.exec("off",[t,e])},each:function(t,e,n){if(!e)throw new Error("yamvish each methods needs a template. (path : "+t+")");return e="string"==typeof e?o().use(e):e,n&&(n="string"==typeof n?o().use(n):n),this.exec("each",[t,e,n])},eachTemplates:function(t,e){return this.exec("eachTemplates",[t,e])},"if":function(t,e,n){return e="string"==typeof e?o().use(e):e,n&&(n="string"==typeof n?o().use(n):n),this.exec("if",[c(t),e,n])},mountIf:function(t,e,n){return e="string"==typeof e?o().use(e):e,n&&(n="string"==typeof n?o().use(n):n),this.exec("mountIf",[c(t),e,n])},"switch":function(t,e){for(var n in e)"string"==typeof e[n]&&(e[n]=o().use(e[n]));return this.exec("switch",[c(t),e])},use:function(t){if(!t)return this;var e=n(arguments);e.shift(),"string"==typeof t&&(t=t.split(":"));var r=t.forEach?u.getApiMethod(l,t):t;return r.__yTemplate__?this._queue=this._queue.concat(r._queue):r.apply(this,e),this},addApi:function(t){var e="string"==typeof t?l[t]:t;if(!e)throw new Error("no template api found with : "+t);for(var n in e)this[n]=e[n];return this},mountHere:function(t){return this.exec("mountHere",[t])},client:function(t){return t=t.__yTemplate__?t:o().use(t),this.exec("client",[t])},server:function(t){return t=t.__yTemplate__?t:o().use(t),this.exec("server",[t])},suspendUntil:function(t){return this.exec("suspendUntil",[c(t),this._queue.length+1,this],!0)},addWitness:function(t){return this.dom(function(e,n){n.addWitness(t)})},log:function(t){return this.exec("log",[t])}},s.addAPI=function(t){for(var e in t)s.prototype[e]=t[e];return s},s.prototype.cl=s.prototype.setClass,["div","span","ul","li","button","p","form","table","tr","td","th","section","code","pre","q","blockquote","style","nav","article","header","footer","aside","label","option"].forEach(function(t){s.prototype[t]=function(){var e=n(arguments);return e.unshift(t),this.tag.apply(this,e)}}),["click","blur","focus","submit","mousedown","mouseup","touchstart","touchend","touchcancel","touchleave","touchmove"].forEach(function(t,e){s.prototype[t]=function(n,r){return"string"==typeof n&&(n=h.parseListener(n)),this.dom(function(i,s,o,a){s.addEventListener(t,function(t){e&&t.preventDefault(),t.targetContainer=a,t.context=i,n.call(i,t)},r)})}}),s.prototype.clickToAgora=function(){var t=arguments;return this.dom(function(e,n,r,i){n.addEventListener("click",function(r){"A"===n.tagName&&r.preventDefault(),r.targetContainer=i,r.context=e,e.toAgora.apply(e,t)})})},e.exports=s},{"./api":5,"./context":7,"./interpolable":10,"./parsers/listener-call":17,"./utils":22}],22:[function(t,e){var n=e.exports={destroyChildren:function(t,e){if(t.childNodes){var r=t.childNodes;e&&(r=[].slice.call(r));for(var i=0;i<r.length;i++)n.destroyElement(r[i],e)}},destroyElement:function(t,e){if(t.context&&(t.context.destroy(),t.context=null),t.__yContainer__?t.childNodes&&n.destroyChildren(t,e):(e&&t.parentNode&&t.parentNode.removeChild(t),3!==t.nodeType&&n.destroyChildren(t)),t.binds){for(var r=0,i=t.binds.length;i>r;r++)t.binds[r]();t.binds=null}},emptyNode:function(t){if(t.childNodes&&t.childNodes.length)for(var e=0,n=t.childNodes.length;n>e;++e){var r=t.childNodes[e];r.parent&&r.parent.removeChild(r)}},hide:function(t){return t.__yContainer__?t.hide():(t.style&&(t.style.display="none"),t)},show:function(t){return t.__yContainer__?t.show():(t.style&&(t.style.display=""),t)},insertBefore:function(t,e,r){if(e.__yContainer__){if(e.childNodes)for(var i=0,s=e.childNodes.length;s>i;++i)n.insertBefore(t,e.childNodes[i],r)}else t.insertBefore(e,r)},getApiMethod:function(t,e){if(e.forEach||(e=e.split(":")),2!==e.length)throw new Error("yamvish method call badly formatted : "+e.join(":"));if(!t[e[0]])throw new Error('no api found with "'+e.join(":")+'"');var n=t[e[0]][e[1]];if(!n)throw new Error('no template/container found with "'+e.join(":")+'"');return n},toBinds:function(t,e){t.binds=nodes.binds||[],t.binds.push(e)},castNodeValueTo:function(t,e){switch(e){case"text":return t.textContent;case"integer":return parseInt(t.textContent,10);case"html":return t.innerHTML;default:throw new Error("content editable casting fail : unrecognised rule : ",e)}}},r=t("nomocas-utils/lib/object-utils");for(var i in r)n[i]=r[i]},{"nomocas-utils/lib/object-utils":3}]},{},[4])(4)});