!function(){function t(t,e){var n=new Error(t);return n.report=e,n}function e(t){return"undefined"!=typeof HTMLElement&&this instanceof HTMLElement}function n(t){if(e(this))for(;this.firstChild;)this.removeChild(this.firstChild);else this.childNodes=[]}function i(t,e,n){try{return e.call(t,t.context||n)}catch(i){return i}}function s(t,e,n,r){for(var o,h=e[0],u=0;h;){if(u++,r){if("catch"!==h.type){h=e[u];continue}o=i(t,h.fn,n,r),r=null}else{if("catch"===h.type){h=e[u];continue}if(o=i(t,h.fn,n),o&&o.then){var a=e.slice(u);return o.then(function(e){return s(t,a,n)},function(e){return s(t,a,n,e)})}}o instanceof Error&&(r=o),h=e[u]}return r&&console.error("has error : ",r,r.stack),r||o}function r(t,e){if(e.forEach&&"$this"===e[0]||"$this"===e)return t;e.forEach||(e=e.split("."));for(var n=t,i=0,s=e.length;s>i;++i)if(n&&!(n=n[e[i]]))return;return n}function o(t,e,n){e.forEach||(e=e.split("."));for(var i,s=t,r=0,o=e.length-1;o>r;++r)s&&!(s=s[e[r]])&&(s=s[e[r]]={});return s&&(i=s[e[r]],s[e[r]]=n),i}function h(t){if(t.context&&(t.context.destroy(),t.context=null),t.childrenContext&&(t.childrenContext.destroy(),t.childrenContext=null),t.__yVirtual__){if(t.attributes=null,t.classList=null,t.listeners=null,t.el&&t.el.parentNode&&t.el.parentNode.removeChild(t.el),t.el.parentNode=null,t.el=null,t.binds)for(var e=0;e<t.binds.length;e++)t.binds[e]()}else t.parentNode&&(t.parentNode.removeChild(t),t.parentNode=null)}function u(t,e,n){this.data=t||{},this.parent=e,this.map={},this.subscribedTo=n;var i=this;n&&(this.bind=e.subscribe(n,function(t,e,n){i.reset(n)}))}function a(t){this._queue=t?t._queue.slice():[]}function l(t,e){this.tagName=t,this.classList=new p,this.__yVirtual__=!0,this.context=e}function c(t){var e=t.split(b);return 1==e.length?t:new v(e)}function f(t,e){for(var n=e||m(),i=0,s=t.childNodes.length;s>i;++i)d(t.childNodes[i],n);return n}function d(t,e){var n=e||m();switch(t.nodeType){case 1:var i=m();if(f(t,i),t.id&&i.id(t.id),t.attributes.length)for(var s=0,r=t.attributes.length;r>s;++s){var o=t.attributes[s];i.attr(o.name,o.value)}for(var h=0;h<t.classList;++h)i.setClass(t.classList[h]);n.tag.apply(n,[t.tagName.toLowerCase(),i]);break;case 3:n.text(t.textContent);break;case 4:console.log("element is CDATA : ",t);break;default:console.warn("k : error : DOM node not managed : type : %s, ",t.nodeType,t)}return n}u.prototype={destroy:function(){this.bind&&this.bind(),this.bind=null,this.parent=null,this.data=null},reset:function(t){return this.data=t||{},this.notifyAll("reset",null,this.map,t),this},set:function(e,n){if(e.forEach||(e=e.split(".")),"$parent"==e[0]){if(this.parent)return this.parent.set(e.slice(1),n);throw t("there is no parent in current context. could not find : "+e.join("."))}this.data=this.data||{};var i=o(this.data,e,n);return i!==n&&this.notify("set",e,n),this},push:function(e,n){if(e.forEach||(e=e.split(".")),"$parent"==e[0]){if(this.parent)return this.parent.push(e.slice(1),n);throw t("there is no parent in current context. could not find : "+e.join("."))}this.data=this.data||{};var i=r(this.data,e);return i||(i=[],o(this.data,e,i)),i.push(n),this.notify("push",e,n,{index:i.length-1}),this},del:function(e){var n;if(e=e.forEach?e.slice():e.split("."),"$parent"==e[0]){if(this.parent)return this.parent.del(e.slice(1));throw t("there is no parent in current context. could not find : "+e.join("."))}n=e.pop();var i=r(this.data,e);if(i)if(i.forEach){var s=parseInt(n,10);i.splice(s,1),this.notify("removeAt",e,null,{index:s})}else delete i[n],this.notify("delete",e,null);return this},get:function(e){if(e.forEach||(e=e.split(".")),"$parent"==e[0]){if(this.parent)return this.parent.get(e.slice(1));throw t("there is no parent in current context. could not find : "+e.join("."))}return r(this.data,e)},subscribe:function(e,n,i){e.forEach||(e=e.split("."));var s;if("$this"===e[0])s=this.map;else{if("$parent"===e[0]){if(this.parent)return this.parent.subscribe(e.slice(1),n,i);throw t("there is no parent in current context. could not find : "+e.join("."))}s=r(this.map,e)}i?s?(s._upstreams=space_upstreams||[]).push(n):o(this.map,e,{_upstreams:[n]}):s?(s._listeners=s._listeners||[]).push(n):o(this.map,e,{_listeners:[n]});var h=this;return function(){h.unsubscribe(e,n,i)}},unsubscribe:function(e,n,i){e.forEach||(e=e.split("."));var s;if("$this"===e[0])s=this.map;else{if("$parent"===e[0]){if(this.parent)return this.parent.unsubscribe(e.slice(1),n,i);throw t("there is no parent in current context. could not find : "+e.join("."))}s=r(this.map,e)}if(s){for(var o=i?s._upstreams:s._listeners,h=0,u=o.length;u>h;++h)if(o[h]===n)return void o.splice(h,1);return this}},notifyAll:function(t,e,n,i,s){if(n=n||this.map,i=arguments.length<2?this.data:i,n._listeners)for(var r=0,o=n._listeners.length;o>r;++r)n._listeners[r](t,e,i,s);if("push"!==t&&"removeAt"!==t)for(var h in n)"_listeners"!==h&&"_upstreams"!==h&&this.notifyAll(t,e,n[h],i?i[h]:void 0);return this},notify:function(t,e,n,i){e.forEach||(e=e.split("."));for(var s=this.map,r=0,o=e.length;o>r;++r){if(s&&!(s=s[e[r]]))return this;if(s._upstreams)for(var r=0,o=s._upstreams.length;o>r;++r)s._upstreams[r](t,e,n,i)}return this.notifyAll(t,e,s,n,i),this}},a.prototype={call:function(t,e){return s(t,this._queue,e||t.context)},done:function(t){return this._queue.push({type:"done",fn:t}),this},"catch":function(t){return this._queue.push({type:"catch",fn:t}),this},"if":function(t,e,n){var i=typeof t;return"string"===i&&(t=c(t)),this.done(function(s){var r=t,o=this,h=function(t,i,r){return r?e.call(o,s):n?n.call(o,s):void 0};return t&&t.__interpolable__?(r=t.output(s.data),(this.binds=this.binds||[]).push(t.subscribeTo(s,h))):"function"===i&&(r=t.call(this,s)),h("set",r)})},all:function(){var t=arguments;return this.done(function(){for(var e=[],n=0,i=t.length;i>n;++n)e.push(t[n].call(this));return Promise.all(e)})},set:function(t,e){return this.done(function(n){n||(n=this.context=new u),n.set(t,e)})},context:function(t){var e;return"string"==typeof t&&(e=t),this.done(function(n){this.context=new u(e?null:t,n,e?e:null)})},destroy:function(){return this.done(function(t){h(this,t)})},remove:function(){return this.done(function(){remove(this)})},"with":function(t){return this.done(function(e){this.childrenContext=new u(null,e,t)})},attr:function(t,e){return"string"==typeof e&&(e=c(e)),this.done(function(n){var i=this;e.__interpolable__?((this.binds=this.binds||[]).push(e.subscribeTo(n,function(e,n,s){i.setAttribute(t,s)})),this.setAttribute(t,e.output(n.data))):this.setAttribute(t,e)})},setClass:function(t,e){arguments.length;return this.done(function(){var n=this,i=function(e,i,s){s?(n.classList.add(t),n.el&&n.el.classList.add(t)):(n.classList.remove(t),n.el&&n.el.classList.remove(t))};e?((this.binds=this.binds||[]).push(context.subscribe(e,i)),i("set",null,context.get(e))):i("set",null,!0)})},on:function(e,n){return this.done(function(i){var s,r=this;if("string"==typeof n){if(!i.handlers)throw t('on(%s) : no "%s" handlers define in current context',e,n);s=i.handlers[n]}else s=n;this.addEventListener(e,function(t){s.call(r,i,t)})})},click:function(t){return this.on("click",t)},off:function(t,e){return this.done(function(){this.removeEventListener(t,e)})},val:function(t){return this.attr("value",t)},text:function(t){return"string"==typeof t&&(t=c(t)),this.done(function(e){var i,s;t.__interpolable__?(s=t.output(e.data),(this.binds=this.binds||[]).push(t.subscribeTo(e,function(t,e,n){i.textContent=n,i.el&&(i.el.nodeValue=n)}))):s=t,this.__yVirtual__?(i=new l("textnode"),i.textContent=s):i=document.createTextNode(s),n(this),this.appendChild(i)})},id:function(t){return this.done(function(){this.id=t})},tag:function(t){var e=arguments;return this.done(function(n){var i;i=this.__yVirtual__?new l(t):document.createElement(t);for(var s,r=1,o=e.length;o>r;++r)s=e[r].call(i,this.childrenContext||n);this.appendChild(i)})},div:function(){var t=Array.prototype.slice.call(arguments);return t.unshift("div"),this.tag.apply(this,t)},each:function(e,i){return this.done(function(s){var r=i||this._eachTemplate;if(!r){if(m.isServer)throw t("no template for .each query handler",this);r=this._eachTemplate=f(this)}var o=function(t,e,i,o){switch(e.forEach&&(e=e.join(".")),t){case"reset":case"set":n(a);for(var l=0,c=i.length;c>l;++l)r.call(a,new u(i[l],s,e+"."+l));break;case"removeAt":h(a.childNodes[o.index]),a.childNodes.splice(o.index,1);break;case"push":r.call(a,new u(i,s,e+"."+o.index)),a.el&&a.el.appendChild(a.childNodes[a.childNodes.length-1].toElement())}},a=this;(this.binds=this.binds||[]).push(s.subscribe(e,o));var l=s.get(e);return l?o("set",e,l):void 0})},push:function(t,e){return this.done(function(n){n.push(t,e)})},del:function(t){return this.done(function(e){e.del(t)})},freeze:function(){return this.done(function(){})},unfreeze:function(){return this.done(function(){})},from:function(t){return this.done(function(){})},css:function(t,e){return this.done(function(){})},visible:function(t){return this.done(function(){})}};var p=function(){this.classes={}};p.prototype={add:function(t){this.classes[t]=!0},remove:function(t){delete this.classes[t]}},l.prototype={setAttribute:function(t,e){(this.attributes=this.attributes||{})[t]=e,this.el&&this.el.setAttribute(t,e)},addEventListener:function(t,e){this.listeners=this.listeners||{},(this.listeners[t]=this.listeners[t]||[]).push(e),this.el&&this.el.addEventListener(name,value)},removeEventListener:function(t,e){if(this.listeners&&this.listeners[t]){for(var n=0,i=this.listeners[t],s=i.length;s>n;++n)if(i[n]===e){i.splice(n,1);break}this.el&&this.el.removeEventListener(name,value)}},appendChild:function(t){return(this.childNodes=this.childNodes||[]).push(t),t},toElement:function(){if("textnode"===this.tagName)return this.el=document.createTextNode(this.textContent);var t=document.createElement(this.tagName);this.id&&(t.id=this.id);for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);for(var n in this.classList.classes)t.classList.add(n);if(this.childNodes)for(var i=0,s=this.childNodes.length;s>i;++i)t.appendChild(this.childNodes[i].toElement());for(var r in this.listeners)for(var o=0,s=this.listeners[r].length;s>o;++o)t.addEventListener(r,this.listeners[r][o]);return this.el=t},toString:function(){if("textnode"===this.tagName)return this.textContent;var t="<"+this.tagName;this.id&&(t+=' id="'+this.id+'"');for(var e in this.attributes)t+=" "+e+'="'+this.attributes[e]+'"';var n=Object.keys(this.classList.classes);if(t+=n.length?' class="'+n.join(" ")+'">':">\n",this.childNodes)for(var i=0,s=this.childNodes.length;s>i;++i)t+=this.childNodes[i].toString()+"\n";return t+="</"+this.tagName+">"}};var v=function(t){if(this.__interpolable__=!0,3===t.length&&""===t[0]&&""===t[2])this.directOutput=t[1],this.dependencies=[t[1]];else{this.splitted=t,this.dependencies=[];for(var e=1,n=t.length;n>e;e+=2)this.dependencies.push(t[e])}};v.prototype={subscribeTo:function(t,e){for(var n=[],i=this,s=0,r=this.dependencies.length;r>s;++s)n.push(t.subscribe(this.dependencies[s],function(n,s,r){e(n,s,i.output(t.data))}));return 1==n.length?n[0]:function(){n.forEach(function(t){t()})}},output:function(t){if(this.directOutput)return r(t,this.directOutput);for(var e="",n=!0,i=0,s=this.splitted.length;s>i;++i)e+=n?this.splitted[i]:r(t,this.splitted[i]),n=!n;return e}};var b=/\{\{\s*([^\}\s]+)\s*\}\}/g,m=function(t){return new a(t)};m.isServer="undefined"!=typeof process&&process.versions&&process.versions.node,m.Context=u,m.Query=a,m.elementChildrenToQuery=f,m.elementToQuery=d,m.interpolable=c,m.Virtual=l,m.Interpolable=v,"undefined"!=typeof module?module.exports=m:this.y=m}();