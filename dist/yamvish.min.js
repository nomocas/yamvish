!function(){function t(t,e){var n=new Error(t);return n.report=e,n}function e(t){return"undefined"!=typeof HTMLElement&&this instanceof HTMLElement}function n(t){if(e(this))for(;this.firstChild;)this.removeChild(this.firstChild);else this.childNodes=[]}function i(t,e,n){try{return e.call(t,t.context||n)}catch(i){return i}}function s(t,e,n,r){for(var o,u=e[0],h=0;u;){if(h++,r){if("catch"!==u.type){u=e[h];continue}o=i(t,u.fn,n,r),r=null}else{if("catch"===u.type){u=e[h];continue}if(o=i(t,u.fn,n),o&&o.then){var a=e.slice(h);return o.then(function(e){return s(t,a,n)},function(e){return s(t,a,n,e)})}}o instanceof Error&&(r=o),u=e[h]}return r&&console.error("has error : ",r,r.stack),r||o}function r(t,e){if(e.forEach&&"$this"===e[0]||"$this"===e)return t;e.forEach||(e=e.split("."));for(var n=t,i=0,s=e.length;s>i;++i)if(n&&!(n=n[e[i]]))return;return n}function o(t,e,n){e.forEach||(e=e.split("."));for(var i,s=t,r=0,o=e.length-1;o>r;++r)s&&!(s=s[e[r]])&&(s=s[e[r]]={});return s&&(i=s[e[r]],s[e[r]]=n),i}function u(t){if(t.context&&(t.context.destroy(),t.context=null),t.childrenContext&&(t.childrenContext.destroy(),t.childrenContext=null),t.__yVirtual__){if(t.attributes=null,t.classList=null,t.listeners=null,t.el&&t.el.parentNode&&t.el.parentNode.removeChild(t.el),t.el.parentNode=null,t.el=null,t.binds)for(var e=0;e<t.binds.length;e++)t.binds[e]()}else t.parentNode&&(t.parentNode.removeChild(t),t.parentNode=null)}function h(t,e,n){this.data=t||{},this.parent=e,this.map={},this.subscribedTo=n;var i=this;n&&(this.bind=e.subscribe(n,function(t,e,n){i.reset(n)}))}function a(t){var e=t.split(d);return 1==e.length?t:new f(e)}h.prototype={destroy:function(){this.bind&&this.bind(),this.bind=null,this.parent=null,this.data=null},reset:function(t){return this.data=t||{},this.notifyAll("reset",null,this.map,t),this},set:function(t,e){t.forEach||(t=t.split(".")),this.data=this.data||{};var n=o(this.data,t,e);return n!==e&&this.notify("set",t,e),this},push:function(t,e){t.forEach||(t=t.split(".")),this.data=this.data||{};var n=r(this.data,t);return n||(n=[],o(this.data,t,n)),n.push(e),this.notify("push",t,e,{index:n.length-1}),this},del:function(t,e){var n;t=t.forEach?t.slice():t.split("."),n=t.pop();var i=r(this.data,t);if(i)if(i.forEach){var s=parseInt(n,10);arr.splice(s,1),this.notify("removeAt",t,null,{index:s})}else delete i[n],this.notify("delete",t,null);return this},get:function(t){return r(this.data,t)},subscribe:function(t,e,n){t.forEach||(t=t.split("."));var i=this.map;"$this"!==t[0]&&(i=r(this.map,t)),n?i?(i._upstreams=space_upstreams||[]).push(e):o(this.map,t,{_upstreams:[e]}):i?(i._listeners=i._listeners||[]).push(e):o(this.map,t,{_listeners:[e]});var s=this;return function(){s.unsubscribe(t,e,n)}},unsubscribe:function(t,e,n){t.forEach||(t=t.split("."));var i=r(this.map,t);if(i){for(var s=n?i._upstreams:i._listeners,o=0,u=s.length;u>o;++o)if(s[o]===e)return void s.splice(o,1);return this}},notifyAll:function(t,e,n,i,s){if(n=n||this.map,i=arguments.length<2?this.data:i,n._listeners)for(var r=0,o=n._listeners.length;o>r;++r)n._listeners[r](t,e,i,s);if("push"!==t&&"removeAt"!==t)for(var u in n)"_listeners"!==u&&"_upstreams"!==u&&this.notifyAll(t,e,n[u],i?i[u]:void 0);return this},notify:function(t,e,n,i){e.forEach||(e=e.split("."));for(var s=this.map,r=0,o=e.length;o>r;++r){if(s&&!(s=s[e[r]]))return this;if(s._upstreams)for(var r=0,o=s._upstreams.length;o>r;++r)s._upstreams[r](t,e,n,i)}return this.notifyAll(t,e,s,n,i),this}};var l=function(t){return new l.Query(t)};l.isServer="undefined"!=typeof process&&process.versions&&process.versions.node,l.Context=h,l.Query=function(t){this._queue=t?t._queue.slice():[]},l.Query.prototype={call:function(t,e){return s(t,this._queue,e||t.context)},done:function(t){return this._queue.push({type:"done",fn:t}),this},"catch":function(t){return this._queue.push({type:"catch",fn:t}),this},"if":function(t,e,n){var i=typeof t;return"string"===i&&(t=a(t)),this.done(function(s){var r=t,o=this,u=function(t,i,r){return r?e.call(o,s):n?n.call(o,s):void 0};return t&&t.__interpolable__?(r=t.output(s.data),(this.binds=this.binds||[]).push(t.subscribeTo(s,u))):"function"===i&&(r=t.call(this,s)),u("set",r)})},all:function(){var t=arguments;return this.done(function(){for(var e=[],n=0,i=t.length;i>n;++n)e.push(t[n].call(this));return Promise.all(e)})},set:function(t,e){return this.done(function(n){n||(n=this.context=new h),n.set(t,e)})},context:function(t){var e;return"string"==typeof t&&(e=t),this.done(function(n){this.context=new h(e?null:t,n,e?e:null)})},destroy:function(){return this.done(function(t){u(this,t)})},remove:function(){return this.done(function(){remove(this)})},"with":function(t){return this.done(function(e){this.childrenContext=new h(null,e,t)})},attr:function(t,e){return"string"==typeof e&&(e=a(e)),this.done(function(n){var i=this;e.__interpolable__?((this.binds=this.binds||[]).push(e.subscribeTo(n,function(e,n,s){i.setAttribute(t,s)})),this.setAttribute(t,e.output(n.data))):this.setAttribute(t,e)})},setClass:function(t,e){var n=arguments.length;return this.done(function(){e||1==n?this.classList.add(t):this.classList.remove(t)})},on:function(e,n){return this.done(function(i){var s=this;if("string"==typeof n){if(!i.handlers)throw t('on(%s) : no "%s" handlers define in current context',e,n);var r=i.handlers[n];this.addEventListener(e,function(t){r.call(s,i,t)})}else this.addEventListener(e,function(t){n.call(s,i,t)})})},click:function(t){return this.on("click",t)},off:function(t,e){return this.done(function(){this.removeEventListener(t,e)})},val:function(t){return this.attr("value",t)},text:function(t){return"string"==typeof t&&(t=a(t)),this.done(function(e){var i,s;t.__interpolable__?(s=t.output(e.data),(this.binds=this.binds||[]).push(t.subscribeTo(e,function(t,e,n){i.textContent=n,i.el&&(i.el.nodeValue=n)}))):s=t,this.__yVirtual__?(i=new l.Virtual("textnode"),i.textContent=s):i=document.createTextNode(s),n(this),this.appendChild(i)})},id:function(t){return this.done(function(){this.id=t})},tag:function(t){var e=arguments;return this.done(function(n){var i;i=this.__yVirtual__?new l.Virtual(t):document.createElement(t);for(var s,r=1,o=e.length;o>r;++r)s=e[r].call(i,this.childrenContext||n);this.appendChild(i)})},div:function(){var t=Array.prototype.slice.call(arguments);return t.unshift("div"),this.tag.apply(this,t)},each:function(e,i){return this.done(function(s){var r=i||this._eachTemplate;if(!r){if(l.isServer)throw t("no template for .each query handler",this);r=this._eachTemplate=l.elementChildrenToQuery(this)}var o=function(t,e,i,o){switch(e.forEach&&(e=e.join(".")),t){case"reset":case"set":n(a);for(var l=0,c=i.length;c>l;++l)r.call(a,new h(i[l],s,e+"."+l));break;case"removeAt":u(a.childNodes[o.index]),a.childNodes.splice(o.index,1);break;case"push":r.call(a,new h(i,s,e+"."+o.index)),a.el&&a.el.appendChild(a.childNodes[a.childNodes.length-1].toElement())}},a=this;(this.binds=this.binds||[]).push(s.subscribe(e,o));var c=s.get(e);return c?o("set",e,c):void 0})},push:function(t,e){return this.done(function(n){n.push(t,e)})},freeze:function(){return this.done(function(){})},unfreeze:function(){return this.done(function(){})},router:function(){return this.done(function(){})},from:function(t){return this.done(function(){})},load:function(t,e,n){return this.done(function(){})},css:function(){return this.done(function(){})}},l.call=function(t){for(var e=[],n=1,i=arguments.length;i>n;++n){var s=arguments[n].call(t);s&&s.then&&e.push(s)}return e.length?Promise.all(e):void 0};var c=function(){this.classes={}};c.prototype={add:function(t){this.classes[t]=!0},remove:function(t){delete this.classes[t]}},l.Virtual=function(t,e){this.tagName=t,this.classList=new c,this.__yVirtual__=!0,this.context=e},l.Virtual.prototype={setAttribute:function(t,e){(this.attributes=this.attributes||{})[t]=e,this.el&&this.el.setAttribute(t,e)},addEventListener:function(t,e){this.listeners=this.listeners||{},(this.listeners[t]=this.listeners[t]||[]).push(e),this.el&&this.el.addEventListener(name,value)},removeEventListener:function(t,e){if(this.listeners&&this.listeners[t]){for(var n=0,i=this.listeners[t],s=i.length;s>n;++n)if(i[n]===e){i.splice(n,1);break}this.el&&this.el.removeEventListener(name,value)}},appendChild:function(t){return(this.childNodes=this.childNodes||[]).push(t),t},toElement:function(){if("textnode"===this.tagName)return this.el=document.createTextNode(this.textContent);var t=document.createElement(this.tagName);this.id&&(t.id=this.id);for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);for(var n in this.classList.classes)t.classList.add(n);if(this.childNodes)for(var i=0,s=this.childNodes.length;s>i;++i)t.appendChild(this.childNodes[i].toElement());for(var r in this.listeners)for(var o=0,s=this.listeners[r].length;s>o;++o)t.addEventListener(r,this.listeners[r][o]);return this.el=t},toString:function(){if("textnode"===this.tagName)return this.textContent;var t="<"+this.tagName;this.id&&(t+=' id="'+this.id+'"');for(var e in this.attributes)t+=" "+e+'="'+this.attributes[e]+'"';var n=Object.keys(this.classList.classes);if(t+=n.length?' class="'+n.join(" ")+'">':">\n",this.childNodes)for(var i=0,s=this.childNodes.length;s>i;++i)t+=this.childNodes[i].toString()+"\n";return t+="</"+this.tagName+">"}},l.elementChildrenToQuery=function(t,e){for(var n=e||l(),i=0,s=t.childNodes.length;s>i;++i)elementToQuery(t.childNodes[i],n);return n},l.elementToQuery=function(t,e){var n=e||l();switch(t.nodeType){case 1:var i=l();if(elementChildrenToQuery(t,i),t.id&&i.id(t.id),t.attributes.length)for(var s=0,r=t.attributes.length;r>s;++s){var o=t.attributes[s];i.attr(o.name,o.value)}for(var u=0;u<t.classList;++u)i.setClass(t.classList[u]);n.tag.apply(n,[t.tagName.toLowerCase(),i]);break;case 3:n.text(t.textContent);break;case 4:console.log("element is CDATA : ",t);break;default:console.warn("k : error : DOM node not managed : type : %s, ",t.nodeType,t)}return n};var f=function(t){if(this.__interpolable__=!0,3===t.length&&""===t[0]&&""===t[2])this.directOutput=t[1],this.dependencies=[t[1]];else{this.splitted=t,this.dependencies=[];for(var e=1,n=t.length;n>e;e+=2)this.dependencies.push(t[e])}};f.prototype={subscribeTo:function(t,e){for(var n=[],i=this,s=0,r=this.dependencies.length;r>s;++s)n.push(t.subscribe(this.dependencies[s],function(n,s,r){e(n,s,i.output(t.data))}));return 1==n.length?n[0]:function(){n.forEach(function(t){t()})}},output:function(t){if(this.directOutput)return r(t,this.directOutput);for(var e="",n=!0,i=0,s=this.splitted.length;s>i;++i)e+=n?this.splitted[i]:r(t,this.splitted[i]),n=!n;return e}};var d=/\{\{\s*([^\}\s]+)\s*\}\}/g;l.interpolable=a,l.Interpolable=f,"undefined"!=typeof module?module.exports=l:this.y=l}();