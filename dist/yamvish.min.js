!function(){function t(t,e){var n=new Error(t);return n.report=e,n}function e(t){return"undefined"!=typeof HTMLElement&&this instanceof HTMLElement}function n(t){if(e(this))for(;this.firstChild;)this.removeChild(this.firstChild);else this.childNodes=[]}function i(t,e,n){try{return e.call(t,t.context||n)}catch(i){return i}}function s(t,e,n,r){for(var o,a=e[0],h=0;a;){if(h++,r){if("catch"!==a.type){a=e[h];continue}o=i(t,a.fn,n,r),r=null}else{if("catch"===a.type){a=e[h];continue}if(o=i(t,a.fn,n),o&&o.then){var u=e.slice(h);return o.then(function(e){return s(t,u,n)},function(e){return s(t,u,n,e)})}}o instanceof Error&&(r=o),a=e[h]}return r&&console.error("has error : ",r,r.stack),r||o}function r(t,e){if(e.forEach&&"$this"===e[0]||"$this"===e)return t;e.forEach||(e=e.split("."));for(var n=t,i=0,s=e.length;s>i;++i)if(!n||void 0===(n=n[e[i]]))return;return n}function o(t,e,n){e.forEach||(e=e.split("."));for(var i,s=t,r=0,o=e.length-1;o>r;++r)s&&!s[e[r]]&&(s=s[e[r]]={});return s&&(i=s[e[r]],s[e[r]]=n),i}function a(t){if(t.context&&(t.context.destroy(),t.context=null),t.childrenContext&&(t.childrenContext.destroy(),t.childrenContext=null),t.__yVirtual__){if(t.attributes=null,t.classList=null,t.listeners=null,t.el&&t.el.parentNode&&t.el.parentNode.removeChild(t.el),t.el.parentNode=null,t.el=null,t.binds)for(var e=0;e<t.binds.length;e++)t.binds[e]()}else t.parentNode&&(t.parentNode.removeChild(t),t.parentNode=null)}function h(t,e){for(var n in t)void 0===e[n]?e[n]=t[n]:t[n].__composition__?e[n]=t[n]._clone()._bottom(e[n]):e[n]=t[n]}function u(t){t=t||{},this.data=void 0!==t.data?t.data:{},this.parent=t.parent,this.handlers=t.handlers||{},this.map={},this.path=t.path;var e=this;t.path&&(this.binds=this.binds||[]).push(this.parent.subscribe(t.path,function(t,n,i){e.reset(i)}))}function l(t){this._queue=t?t._queue.slice():[]}function c(e){e=e||{},this.tagName=e.tagName,this.classList=new v,this.__yVirtual__=!0,e.context&&(this.context=e.context);var n=e.context||g.mainContext;if(e.template){if(!n)throw t("no context could be found when initialising Virtual with template. aborting.",this);e.template.call(this,n)}}function f(t){var e=t.split(b);return 1==e.length?t:new m(e)}function d(t,e){for(var n=e||g(),i=0,s=t.childNodes.length;s>i;++i)p(t.childNodes[i],n);return n}function p(t,e){var n=e||g();switch(t.nodeType){case 1:var i=g();if(d(t,i),t.id&&i.id(t.id),t.attributes.length)for(var s=0,r=t.attributes.length;r>s;++s){var o=t.attributes[s];i.attr(o.name,o.value)}for(var a=0;a<t.classList;++a)i.setClass(t.classList[a]);n.tag.apply(n,[t.tagName.toLowerCase(),i]);break;case 3:n.text(t.textContent);break;case 4:console.log("element is CDATA : ",t);break;default:console.warn("y.elementToTemplate : DOM node not managed : type : %s, ",t.nodeType,t)}return n}u.prototype={destroy:function(){this.binds&&this.binds.forEach(function(t){t()}),this.binds=null,this.parent=null,this.data=null,this.handlers=null,this.map=null},reset:function(t){return this.data=t||{},this.notifyAll("reset",null,this.map,t),this},set:function(e,n){if(e.forEach||(e=e.split(".")),"$this"===e[0])return this.reset(n);if("$parent"===e[0]){if(this.parent)return this.parent.set(e.slice(1),n);throw t("there is no parent in current context. could not find : "+e.join("."))}this.data=this.data||{};var i=o(this.data,e,n);return i!==n&&this.notify("set",e,n),this},push:function(e,n){if(e.forEach||(e=e.split(".")),"$parent"==e[0]){if(this.parent)return this.parent.push(e.slice(1),n);throw t("there is no parent in current context. could not find : "+e.join("."))}var i;return i="$this"===e[0]?this.data:r(this.data,e),i||(i=[],o(this.data,e,i)),i.push(n),this.notify("push",e,n,{index:i.length-1}),this},del:function(e){if(e=e.forEach?e.slice():e.split("."),"$parent"==e[0]){if(this.parent)return this.parent.del(e.slice(1));throw t("there is no parent in current context. could not find : "+e.join("."))}var n=e.pop(),i=e.length?r(this.data,e):this.data;if(i)if(i.forEach){var s=parseInt(n,10);i.splice(s,1),this.notify("removeAt",e,null,{index:s})}else delete i[n],this.notify("delete",e,null);return this},get:function(e){if(e.forEach||(e=e.split(".")),"$this"===e[0])return this.data;if("$parent"==e[0]){if(this.parent)return this.parent.get(e.slice(1));throw t("there is no parent in current context. could not find : "+e.join("."))}return r(this.data,e)},subscribe:function(e,n,i){e.forEach||(e=e.split("."));var s;if("$this"===e[0])s=this.map;else{if("$parent"===e[0]){if(this.parent)return this.parent.subscribe(e.slice(1),n,i);throw t("there is no parent in current context. could not find : "+e.join("."))}s=r(this.map,e)}i?s?(s._upstreams=space_upstreams||[]).push(n):o(this.map,e,{_upstreams:[n]}):s?(s._listeners=s._listeners||[]).push(n):o(this.map,e,{_listeners:[n]});var a=this;return function(){a.unsubscribe(e,n,i)}},unsubscribe:function(e,n,i){e.forEach||(e=e.split("."));var s;if("$this"===e[0])s=this.map;else{if("$parent"===e[0]){if(this.parent)return this.parent.unsubscribe(e.slice(1),n,i);throw t("there is no parent in current context. could not find : "+e.join("."))}s=r(this.map,e)}if(s){for(var o=i?s._upstreams:s._listeners,a=0,h=o.length;h>a;++a)if(o[a]===n)return void o.splice(a,1);return this}},notifyAll:function(t,e,n,i,s){if(n=n||this.map,i=arguments.length<2?this.data:i,n._listeners)for(var r=0,o=n._listeners.length;o>r;++r)n._listeners[r](t,e,i,s);if("push"!==t&&"removeAt"!==t)for(var a in n)"_listeners"!==a&&"_upstreams"!==a&&this.notifyAll(t,e,n[a],i?i[a]:void 0);return this},notify:function(t,e,n,i){e.forEach||(e=e.split(".")),"$this"===e[0]&&(e=[]);for(var s=this.map,r=0,o=e.length;o>r;++r){if(s&&!(s=s[e[r]]))return this;if(s._upstreams)for(var r=0,o=s._upstreams.length;o>r;++r)s._upstreams[r](t,e,n,i)}return this.notifyAll(t,e,s,n,i),this}},l.prototype={call:function(t,e){return s(t,this._queue,e||t.context)},done:function(t){return this._queue.push({type:"done",fn:t}),this},"catch":function(t){return this._queue.push({type:"catch",fn:t}),this},"if":function(t,e,n){var i=typeof t;return"string"===i&&(t=f(t)),this.done(function(s){var r=t,o=this,a=function(t,i,r){return r?e.call(o,s):n?n.call(o,s):void 0};return t&&t.__interpolable__?(r=t.output(s),(this.binds=this.binds||[]).push(t.subscribeTo(s,a))):"function"===i&&(r=t.call(this,s)),a("set",r)})},all:function(){var t=arguments;return this.done(function(){for(var e=[],n=0,i=t.length;i>n;++n)e.push(t[n].call(this));return Promise.all(e)})},set:function(e,n){return this.done(function(i){if(i=i||this.context||g.mainContext,!i)throw t("no context avaiable to set variable in it. aborting.",this);i.set(e,n)})},push:function(t,e){return this.done(function(n){n.push(t,e)})},del:function(t){return this.done(function(e){e.del(t)})},handlers:function(t,e){return this.done(function(n){(n.handlers=n.handlers||{})[t]=e})},context:function(t){var e;return"string"==typeof t&&(e=t),this.done(function(n){this.context=new u({data:e?null:t,parent:n,path:e?e:null})})},"with":function(t){return this.done(function(e){this.childrenContext=new u({parent:e,path:t})})},destroy:function(){return this.done(function(t){a(this,t)})},remove:function(){return this.done(function(){remove(this)})},attr:function(t,e){return"string"==typeof e&&(e=f(e)),this.done(function(n){var i=this;e.__interpolable__?((this.binds=this.binds||[]).push(e.subscribeTo(n,function(e,n,s){i.setAttribute(t,s)})),this.setAttribute(t,e.output(n))):this.setAttribute(t,e)})},id:function(t){return this.done(function(){this.id=t})},val:function(t){return this.attr("value",t)},setClass:function(t,e){arguments.length;return this.done(function(n){var i=this,s=function(e,n,s){s?(i.classList.add(t),i.el&&i.el.classList.add(t)):(i.classList.remove(t),i.el&&i.el.classList.remove(t))};e?((this.binds=this.binds||[]).push(n.subscribe(e,s)),s("set",null,n.get(e))):s("set",null,!0)})},on:function(e,n){return this.done(function(i){var s;if("string"==typeof n){if(!i.handlers)throw t("on("+e+') : no "'+n+'" handlers define in current context',this);s=i.handlers[n]}else s=n;this.addEventListener(e,function(t){return s.call(i,t)})})},off:function(t,e){return this.done(function(){this.removeEventListener(t,e)})},text:function(t){return"string"==typeof t&&(t=f(t)),this.done(function(e){var i,s;t.__interpolable__?(s=t.output(e),(this.binds=this.binds||[]).push(t.subscribeTo(e,function(t,e,n){i.textContent=n,i.el&&(i.el.nodeValue=n)}))):s=t,this.__yVirtual__?(i=new c({tagName:"textnode"}),i.textContent=s):i=document.createTextNode(s),n(this),this.appendChild(i)})},tag:function(t){var e=arguments;return this.done(function(n){var i;i=this.__yVirtual__?new c({tagName:t}):document.createElement(t);for(var s,r=1,o=e.length;o>r;++r)s="string"==typeof e[r]?g().text(e[r]).call(i,this.childrenContext||n):e[r].call(i,this.childrenContext||n);this.appendChild(i)})},a:function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift("a",g().attr("href",t)),this.tag.apply(this,e)},input:function(t,e){var n=Array.prototype.slice.call(arguments,2);return n.unshift("input",g().attr("type",t).attr("value",e).on("input",function(t,e){console.log("input.input : ",e)})),this.tag.apply(this,n)},h:function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift("h"+t),this.tag.apply(this,e)},each:function(e,i){return this.done(function(s){var r=i||this._eachTemplate,o=this;if(!r){if(g.isServer)throw t("no template for .each template handler",this);r=this._eachTemplate=d(this)}var h=function(t,e,i,h){switch(e.forEach&&(e=e.join(".")),t){case"reset":case"set":n(o);for(var l=0,c=i.length;c>l;++l)r.call(o,new u({data:i[l],parent:s,path:e+"."+l}));break;case"removeAt":a(o.childNodes[h.index]),o.childNodes.splice(h.index,1);break;case"push":r.call(o,new u({data:i,parent:s,path:e+"."+h.index}))}};(this.binds=this.binds||[]).push(s.subscribe(e,h));var l=s.get(e);return l?h("set",e,l):void 0})},freeze:function(){return this.done(function(){})},unfreeze:function(){return this.done(function(){})},from:function(t){return this.done(function(){})},css:function(t,e){return this.done(function(){})},visible:function(t){return this.done(function(){})}},["div","span","ul","li","button","p"].forEach(function(t){l.prototype[t]=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(t),this.tag.apply(this,e)}}),["click","blur","focus"].forEach(function(t){l.prototype[t]=function(e){return this.on(t,e)}});var v=function(){this.classes={}};v.prototype={add:function(t){this.classes[t]=!0},remove:function(t){delete this.classes[t]}},c.prototype={setAttribute:function(t,e){(this.attributes=this.attributes||{})[t]=e,this.el&&this.el.setAttribute(t,e)},addEventListener:function(t,e){this.listeners=this.listeners||{},(this.listeners[t]=this.listeners[t]||[]).push(e),this.el&&this.el.addEventListener(name,value)},removeEventListener:function(t,e){if(this.listeners&&this.listeners[t]){for(var n=0,i=this.listeners[t],s=i.length;s>n;++n)if(i[n]===e){i.splice(n,1);break}this.el&&this.el.removeEventListener(name,value)}},appendChild:function(t){return(this.childNodes=this.childNodes||[]).push(t),this.el&&this.el.appendChild(t.toElement()),t},toElement:function(){if("textnode"===this.tagName)return this.el=document.createTextNode(this.textContent);var t=document.createElement(this.tagName);this.id&&(t.id=this.id);for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);for(var n in this.classList.classes)t.classList.add(n);if(this.childNodes)for(var i=0,s=this.childNodes.length;s>i;++i)t.appendChild(this.childNodes[i].toElement());for(var r in this.listeners)for(var o=0,s=this.listeners[r].length;s>o;++o)t.addEventListener(r,this.listeners[r][o]);return this.el=t},toString:function(){if("textnode"===this.tagName)return this.textContent;var t="<"+this.tagName;this.id&&(t+=' id="'+this.id+'"');for(var e in this.attributes)t+=" "+e+'="'+this.attributes[e]+'"';var n=Object.keys(this.classList.classes);if(t+=n.length?' class="'+n.join(" ")+'">':">\n",this.childNodes)for(var i=0,s=this.childNodes.length;s>i;++i)t+=this.childNodes[i].toString()+"\n";return t+="</"+this.tagName+">"}};var m=function(t){if(this.__interpolable__=!0,3===t.length&&""===t[0]&&""===t[2])this.directOutput=t[1],this.dependencies=[t[1]];else{this.splitted=t,this.dependencies=[];for(var e=1,n=t.length;n>e;e+=2)this.dependencies.push(t[e])}};m.prototype={subscribeTo:function(t,e){for(var n=[],i=this,s=0,r=this.dependencies.length;r>s;++s)n.push(t.subscribe(this.dependencies[s],function(n,s,r){e(n,s,i.directOutput?r:i.output(t))}));return 1==n.length?n[0]:function(){n.forEach(function(t){t()})}},output:function(t){if(this.directOutput)return t.get(this.directOutput);for(var e="",n=!0,i=0,s=this.splitted.length;s>i;++i)e+=n?this.splitted[i]:t.get(this.splitted[i]),n=!n;return e}};var b=/\{\{\s*([^\}\s]+)\s*\}\}/g,g=function(t){return new l(t)};g.View=function(t){t=t||{},this.context=t.context=this,t.componentName&&g.addComponent(t.componentName,this),u.call(this,t),c.call(this,t)},h(c.prototype,g.View.prototype),h(l.prototype,g.View.prototype),h(u.prototype,g.View.prototype),g.View.prototype.done=function(t){t.call(this,this)},g.components={},g.addComponent=function(t,e){g.components[t]=e},g.isServer="undefined"!=typeof process&&process.versions&&process.versions.node,g.Context=u,g.Template=l,g.elementChildrenToTemplate=d,g.elementToTemplate=p,g.interpolable=f,g.Virtual=c,g.Interpolable=m,"undefined"!=typeof module?module.exports=g:this.y=g}();