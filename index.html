<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>yamvish tests</title>
    <script type="text/javascript" src="./dist/yamvish.js"></script>
</head>

<body>
    <div>
        <button onclick="test.dom()">dom</button>
        <button onclick="test.string()">string</button>
        <button onclick="test.twopass()">twopass</button>
        <button onclick="test.twopass2()">twopass2</button>
        <button onclick="test.pushItem()">push item</button>
        <button onclick="test.killArray()">kill Array</button>
        <button onclick="test.del0()">del 0</button>
        <button onclick="test.set100()">set 100</button>
        <button onclick="test.set200()">set 200</button>
        <button onclick="test.router()">router</button>
        <span id="res"></span>
    </div>
    <div id="app"></div>
    <script type="text/javascript">
    function range(size) {
        var output = [];
        for (var i = 0; i < size; ++i)
            output.push(Math.random() + "");
        return output;
    }

    //_____________________________________ STRING

    var t = y()
        .set('world', 'yamvish')
        .set('title', 'wuuu')
        .set('items', range(200))
        //__________________________________________
        .div('hello {{ world }}')
        .div('title {{ title }}')
        .input('text', '{{ world }}')
        .div(
            y()
            .div('____')
            .if('{{ world === "yamvish" }}', y().p('yessssssss').p('weeee'), y().p('hooooo'))
            .div('____')
            .if('{{ world === "yamvishs" }}', y().p('wiiii').h(3, 'wwwwwhoooowwww'))
            .div('____')
        )
        // .div(
        // y()
        .each(
            'items',
            y().p('{{ $this }}')
            .section('biupi')
            .header('{{ $this }}')
            .header('{{ $this }}')
            .footer('biupi'),
            y().p('array empty')
        )
        .div('____')
        // )
        .div(
            y().context()
            .attr('reu', true)
            .set('title', 'weeeeee')
            .text('{{ title }}')
        );

    // for (var j = 0; j < 200; ++j)
    // // t.p('fgfgfg');
    //     t.p('{{ world }}');



    test = {}

    test.string = function() {
        var time = new Date().getTime();

        // for (var i = 0; i < 1000; ++i)
        // console.log(
        t.toHTMLString()

        time = new Date().getTime() - time;
        console.log('string time : ', time);
        document.getElementById('res').innerHTML = time;
    };

    test.string2 = function() {

        var time = new Date().getTime();
        var promises = [];

        // for (var i = 0; i < 1000; ++i)
        promises.push(
            // console.log(
            t.toHTMLString()
        );

        Promise.all(promises)
            .then(function(res) {
                time = new Date().getTime() - time;
                console.log('string time : ', time);
                document.getElementById('res').innerHTML = time;
                // string();
            }).catch(function(e) {
                console.error(e);
                console.log(e.stack);
            });
    };
    //____________________________ TWO PASS


    test.twopass = function() {
        console.log('twopass');
        var time = new Date().getTime();
        // for (var i = 0; i < 1000; ++i)
        t.twopass()
        time = new Date().getTime() - time;
        console.log('twopass time : ', time);
        document.getElementById('res').innerHTML = time;
    };

    test.twopass2 = function() {
        var promises = [];
        console.log('twopass2');
        var time = new Date().getTime();

        // for (var i = 0; i < 1000; ++i) {
        promises.push(
            // console.log(
            t.twopass()
        );
        // }
        Promise.all(promises)
            .then(function(res) {
                time = new Date().getTime() - time;
                console.log('twopass2 time : ', time);
                document.getElementById('res').innerHTML = time;
                // string();
            }).catch(function(e) {
                console.error(e);
                console.log(e.stack);
            });
    };
    //____________________________________________________________________________________ DOM



    test.dom = function() {
        document.getElementById('app').innerHTML = '';
        var ctx = new y.Context();

        var time = new Date().getTime();

        // for (var i = 0; i < 100; ++i)
        // console.log(
        var c = t.toContainer(ctx).mount('#app'); //.toString()
        // )
        time = new Date().getTime() - time;

        ctx.set('title', time);

        test.pushItem = function() {
            ctx.push('items', 'jhdjkhzeokhzekhezhez ' + Math.random());
        };
        test.killArray = function() {
            var time = new Date().getTime();
            ctx.set('items', []);
            time = new Date().getTime() - time;
            ctx.set('title', time);
        };
        test.del0 = function() {
            ctx.del('items.0');
        };
        test.set100 = function() {
            var r = range(100);
            var time = new Date().getTime();
            ctx.set('items', r);
            time = new Date().getTime() - time;
            ctx.set('title', time);
        };
        test.set200 = function() {
            var r = range(200);
            var time = new Date().getTime();
            ctx.set('items', r);
            time = new Date().getTime() - time;
            ctx.set('title', time);
        };
        // document.getElementById('app').innerHTML = time;
    }



    test.router = function() {
        var rootContext = new y.Context()
            .set('$env.language', 'fr')
            .onAgora('bloupi', function(context, msg) {
                console.log('rootContext receive bloupi : ', msg);
            });

        y.router.bindHistory(rootContext);

        var mainView = y.view({
                myAction: function(e) {
                    console.log('my action');
                    this.set('test', true);
                },
                myAction2: function(e) {
                    console.log('my action2');
                },
                testOutput: function(arg) {
                    return '[[' + arg + ']]';
                },
                obj: {
                    title: 'holaaaa',
                    test2: function(arg) {
                        return 'test2:' + arg + this.title;
                    }
                }
            })
            .set('reu', 'wiiiii')
            .button('click to /', y().clickTo('/', 'root'))
            .button('click to /hoo', y().clickTo('/hoo', 'hoooooooo'))
            .button('click to /hoo/hisss', y().clickTo('/hoo/hisss', 'hissssssssss'))
            .button('/hoo/hisss/huue', y().clickTo('/hoo/hisss/huue', 'hohihu'))
            .button('/hoo/huue', y().clickTo('/hoo/huue', 'hohu'))
            .route('/hoo', function(matched) {
                // console.log('view1 matched : ', matched);
                // this.toAgora('bloupi', 'view1 route matched : ', matched);
            })
            //_______________________________
            .br().br()
            .text('loli - {{ reu }} - {{ testOutput(12) }} - {{ obj.test2(33) }}')
            .p('lolooooo - {{ $env.language }}')
            .br().br().br()
            .text('route : {{ $route.route.join("|") }}')
            .div(
                y.view()
                .route('./hisss', function(matched) {
                    // console.log('view2 matched : ', matched);
                })
                .p('route2 : {{ $route.route.join("|")  }}')
            )
            .div(
                y.view()
                .route('./huue', function(matched) {
                    // console.log('view3 matched : ', matched);
                })
                .p('route3 : {{ $route.route.join("|")  }}')
                .use(t)
            )
            .button('do test', y().click('myAction'))
            .button('do test2', y().click('myAction2'))
            .suspendUntil('{{ test }}')
            .div('after suspension');



        mainView.toContainer(rootContext).mount('#app');
    }



    // string();
    // string2();
    // test.twopass();
    // twopass2();
    //test.dom();
    </script>
</body>

</html>
